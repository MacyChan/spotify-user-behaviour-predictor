
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Machine Learning analysis &#8212; Spotify User Behaviour Predictor</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Conclusion" href="7_Conclusion.html" />
    <link rel="prev" title="Feature engineering" href="5_Feature_Engine.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Spotify User Behaviour Predictor</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="1_intro.html">
   ReadMe
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="2_about_proj.html">
   About this project
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="3_EDA.html">
   Explanatory data analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="4_Stat_Infer.html">
   Statistic Inference
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="5_Feature_Engine.html">
   Feature engineering
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Machine Learning analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="7_Conclusion.html">
   Conclusion
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/6_Machine_Learning.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/macychan/Spotify-user-behaviour-predictor"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/macychan/Spotify-user-behaviour-predictor/issues/new?title=Issue%20on%20page%20%2F6_Machine_Learning.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/macychan/Spotify-user-behaviour-predictor/main?urlpath=tree/docs/6_Machine_Learning.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#imports">
   Imports
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#import-libraries">
     Import libraries
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#reading-the-data-csv">
     Reading the data CSV
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-splitting">
   Data splitting
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#scoring-metric">
   Scoring metric
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#preprocessing-and-transformations">
   Preprocessing and transformations
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#baseline-model">
   Baseline model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#linear-models">
   Linear models
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#model-training-logisticregression">
     Model training - LogisticRegression
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hyperparameter-optimization">
     hyperparameter optimization
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#model-interpretation-on-training-set">
     Model interpretation on Training set
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#non-linear-models">
   Non-linear models
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#model-training-randomforestclassifier-xgbclassifier-lgbmclassifier-catboostclassifier">
     Model training - RandomForestClassifier, XGBClassifier, LGBMClassifier, CatBoostClassifier
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hyperparameter-optimization-very-time-consuming-tbc">
     Hyperparameter optimization (Very time consuming, TBC)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Model interpretation on Training set
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#model-averaging">
   Model Averaging
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#results-on-the-test-set">
   Results on the test set
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#interpretation-and-feature-importances-on-test-set">
     Interpretation and feature importances on Test set
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#summary-of-machine-learning-results">
   Summary of machine learning results
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Machine Learning analysis</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#imports">
   Imports
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#import-libraries">
     Import libraries
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#reading-the-data-csv">
     Reading the data CSV
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-splitting">
   Data splitting
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#scoring-metric">
   Scoring metric
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#preprocessing-and-transformations">
   Preprocessing and transformations
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#baseline-model">
   Baseline model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#linear-models">
   Linear models
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#model-training-logisticregression">
     Model training - LogisticRegression
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hyperparameter-optimization">
     hyperparameter optimization
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#model-interpretation-on-training-set">
     Model interpretation on Training set
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#non-linear-models">
   Non-linear models
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#model-training-randomforestclassifier-xgbclassifier-lgbmclassifier-catboostclassifier">
     Model training - RandomForestClassifier, XGBClassifier, LGBMClassifier, CatBoostClassifier
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hyperparameter-optimization-very-time-consuming-tbc">
     Hyperparameter optimization (Very time consuming, TBC)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Model interpretation on Training set
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#model-averaging">
   Model Averaging
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#results-on-the-test-set">
   Results on the test set
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#interpretation-and-feature-importances-on-test-set">
     Interpretation and feature importances on Test set
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#summary-of-machine-learning-results">
   Summary of machine learning results
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="machine-learning-analysis">
<h1>Machine Learning analysis<a class="headerlink" href="#machine-learning-analysis" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p>This is a Python base notebook</p></li>
</ul>
<p>Kaggle’s <a class="reference external" href="https://www.kaggle.com/geomack/spotifyclassification/home">Spotify Song Attributes</a> dataset contains a number of features of songs from 2017 and a binary variable <code class="docutils literal notranslate"><span class="pre">target</span></code> that represents whether the user liked the song (encoded as 1) or not (encoded as 0). See the documentation of all the features <a class="reference external" href="https://developer.spotify.com/documentation/web-api/reference/tracks/get-audio-features/">here</a>.</p>
<div class="section" id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Permalink to this headline">¶</a></h2>
<div class="section" id="import-libraries">
<h3>Import libraries<a class="headerlink" href="#import-libraries" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="c1">#from sklearn import datasets</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span><span class="p">,</span> <span class="n">make_column_transformer</span>

<span class="c1">#from sklearn.impute import SimpleImputer</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">RandomizedSearchCV</span><span class="p">,</span>
<span class="c1">#    cross_val_score,</span>
    <span class="n">cross_validate</span><span class="p">,</span>
    <span class="n">train_test_split</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span> <span class="c1">#Pipeline, make_pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">OneHotEncoder</span>
<span class="c1">#from sklearn.svm import SVC, SVR</span>
<span class="c1">#from sklearn.preprocessing import PolynomialFeatures</span>

<span class="kn">from</span> <span class="nn">sklearn.dummy</span> <span class="kn">import</span> <span class="n">DummyClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span><span class="p">,</span> <span class="n">Ridge</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">lightgbm.sklearn</span> <span class="kn">import</span> <span class="n">LGBMClassifier</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>
<span class="kn">from</span> <span class="nn">catboost</span> <span class="kn">import</span> <span class="n">CatBoostClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">VotingClassifier</span>
<span class="c1">#from sklearn.feature_selection import RFECV</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">classification_report</span><span class="p">,</span>
    <span class="n">roc_curve</span><span class="p">,</span>
    <span class="n">RocCurveDisplay</span><span class="p">,</span>
    <span class="n">roc_auc_score</span>
<span class="p">)</span>

<span class="kn">import</span> <span class="nn">shap</span>
<span class="c1">#from sklearn.model_selection import cross_val_predict</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">mean_std_cross_val_scores</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns mean and std of cross validation</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    model :</span>
<span class="sd">        scikit-learn model</span>
<span class="sd">    X_train : numpy array or pandas DataFrame</span>
<span class="sd">        X in the training data</span>
<span class="sd">    y_train :</span>
<span class="sd">        y in the training data</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">        pandas Series with mean scores from cross_validation</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">scores</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">mean_scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">std_scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    <span class="n">out_col</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mean_scores</span><span class="p">)):</span>
        <span class="n">out_col</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="sa">f</span><span class="s2">&quot;%0.3f (+/- %0.3f)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mean_scores</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">std_scores</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">out_col</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">mean_scores</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="reading-the-data-csv">
<h3>Reading the data CSV<a class="headerlink" href="#reading-the-data-csv" title="Permalink to this headline">¶</a></h3>
<p>Read in the data CSV and store it as a pandas dataframe named <code class="docutils literal notranslate"><span class="pre">spotify_df</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spotify_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/spotify_df_processed.csv&#39;</span><span class="p">)</span><span class="c1">#, index_col = 0 )</span>
<span class="n">spotify_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>acousticness</th>
      <th>danceability</th>
      <th>duration_ms</th>
      <th>energy</th>
      <th>instrumentalness</th>
      <th>key</th>
      <th>liveness</th>
      <th>loudness</th>
      <th>mode</th>
      <th>speechiness</th>
      <th>...</th>
      <th>genres_west coast rap</th>
      <th>genres_west coast trap</th>
      <th>genres_wonky</th>
      <th>genres_worcester ma indie</th>
      <th>genres_world</th>
      <th>genres_world fusion</th>
      <th>genres_world worship</th>
      <th>genres_worship</th>
      <th>genres_zolo</th>
      <th>lyrics</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0102</td>
      <td>0.833</td>
      <td>204600</td>
      <td>0.434</td>
      <td>0.0219</td>
      <td>2</td>
      <td>0.165</td>
      <td>-8.795</td>
      <td>1</td>
      <td>0.431</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>\nCall it how it is (Call it how it is)\nHendr...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.0102</td>
      <td>0.833</td>
      <td>204600</td>
      <td>0.434</td>
      <td>0.0219</td>
      <td>2</td>
      <td>0.165</td>
      <td>-8.795</td>
      <td>1</td>
      <td>0.431</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>\nThree exotic broads and I got 'em soakin' pa...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.0102</td>
      <td>0.833</td>
      <td>204600</td>
      <td>0.434</td>
      <td>0.0219</td>
      <td>2</td>
      <td>0.165</td>
      <td>-8.795</td>
      <td>1</td>
      <td>0.431</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>\nThey gave lil' Trotty 25 for them thangs, ni...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.0102</td>
      <td>0.833</td>
      <td>204600</td>
      <td>0.434</td>
      <td>0.0219</td>
      <td>2</td>
      <td>0.165</td>
      <td>-8.795</td>
      <td>1</td>
      <td>0.431</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>\n\n\nReal dope dealers for real, haha\nHahaha...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.0102</td>
      <td>0.833</td>
      <td>204600</td>
      <td>0.434</td>
      <td>0.0219</td>
      <td>2</td>
      <td>0.165</td>
      <td>-8.795</td>
      <td>1</td>
      <td>0.431</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>\nYeah\nI woke up feeling like fucking up some...</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.0102</td>
      <td>0.833</td>
      <td>204600</td>
      <td>0.434</td>
      <td>0.0219</td>
      <td>2</td>
      <td>0.165</td>
      <td>-8.795</td>
      <td>1</td>
      <td>0.431</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>\nBeast mode\n(Zaytoven)\n\n\nI fuck on that b...</td>
    </tr>
  </tbody>
</table>
<p>6 rows × 878 columns</p>
</div></div></div>
</div>
</div>
</div>
<div class="section" id="data-splitting">
<h2>Data splitting<a class="headerlink" href="#data-splitting" title="Permalink to this headline">¶</a></h2>
<p>Split the data into train and test portions. Remove <code class="docutils literal notranslate"><span class="pre">song_title</span></code>, separate data to <code class="docutils literal notranslate"><span class="pre">X_train</span></code>, <code class="docutils literal notranslate"><span class="pre">y_train</span></code>, <code class="docutils literal notranslate"><span class="pre">X_test</span></code>, <code class="docutils literal notranslate"><span class="pre">y_test</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span><span class="p">,</span> <span class="n">test_df</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">spotify_df</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]),</span> <span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
<span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]),</span> <span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># printing the number of observations for train and test sets</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The number of observations for train set: &#39;</span><span class="p">,</span> <span class="n">train_df</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The number of observations for test set: &#39;</span><span class="p">,</span> <span class="n">test_df</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The number of observations for train set:  3831
The number of observations for test set:  958
</pre></div>
</div>
</div>
</div>
<p>I split 20% of the observations in the test data and 80% in the train data set. Overall the data set has about 2,000 observations, as it is not a very large data set, I preserved more portion for training.</p>
</div>
<div class="section" id="scoring-metric">
<h2>Scoring metric<a class="headerlink" href="#scoring-metric" title="Permalink to this headline">¶</a></h2>
<p>Since it is a balanced data set and both positive and negative class are equally balanced, accuracy and precision-recall curves are selected as scoring metric.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scoring_metric</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;accuracy&quot;</span><span class="p">,</span> <span class="s2">&quot;roc_auc&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="preprocessing-and-transformations">
<h2>Preprocessing and transformations<a class="headerlink" href="#preprocessing-and-transformations" title="Permalink to this headline">¶</a></h2>
<p>Here is different feature types and the transformations I will apply on each feature type.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:right head"><p>Transformation</p></th>
<th class="head"><p>Reason</p></th>
<th class="head"><p>Features</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:right"><p>OneHotEncoder</p></td>
<td><p>All of these features have fixed number of categories. <code class="docutils literal notranslate"><span class="pre">key</span></code> is circulated features like months. <code class="docutils literal notranslate"><span class="pre">artist</span></code>, <code class="docutils literal notranslate"><span class="pre">genres</span></code>, <code class="docutils literal notranslate"><span class="pre">artist_style</span></code> have limited categories.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">key</span></code>, <code class="docutils literal notranslate"><span class="pre">artist</span></code>, <code class="docutils literal notranslate"><span class="pre">genres</span></code>, <code class="docutils literal notranslate"><span class="pre">artist_style</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-align:right"><p>StandardScaler</p></td>
<td><p>Numeric columns needs standardization</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">acousticness</span></code>, <code class="docutils literal notranslate"><span class="pre">danceability</span></code>, <code class="docutils literal notranslate"><span class="pre">duration_ms</span></code>, <code class="docutils literal notranslate"><span class="pre">energy</span></code>, <code class="docutils literal notranslate"><span class="pre">instrumentalness</span></code>, <code class="docutils literal notranslate"><span class="pre">liveness</span></code>, <code class="docutils literal notranslate"><span class="pre">loudness</span></code>, <code class="docutils literal notranslate"><span class="pre">mode</span></code>, <code class="docutils literal notranslate"><span class="pre">speechiness</span></code>, <code class="docutils literal notranslate"><span class="pre">tempo</span></code>, <code class="docutils literal notranslate"><span class="pre">time_signature</span></code>, <code class="docutils literal notranslate"><span class="pre">valence</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-align:right"><p>Glove (TBC)</p></td>
<td><p>Catagorize lyrics word using Glove</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">lyrics</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-align:right"><p>none</p></td>
<td><p>The format are as required</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">genres_</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-align:right"><p>drop</p></td>
<td><p>Free text column which has low correlation with target.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">song_title</span></code></p></td>
</tr>
</tbody>
</table>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">category_feats</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">,</span> <span class="s2">&quot;artist&quot;</span><span class="p">]</span>
<span class="n">glove_feats</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;lyrics&#39;</span><span class="p">]</span>
<span class="n">none_feats</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">X_train</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;genres_&#39;</span><span class="p">)]</span>
<span class="n">drop_feats</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;song_title&#39;</span><span class="p">]</span>


<span class="n">numeric_feats</span>  <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">category_feats</span><span class="p">)</span>
            <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">glove_feats</span><span class="p">)</span>
            <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">none_feats</span><span class="p">)</span>
            <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">drop_feats</span><span class="p">)</span>
        <span class="p">)</span>

<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
    <span class="p">(</span><span class="s2">&quot;drop&quot;</span><span class="p">,</span> <span class="n">drop_feats</span><span class="p">),</span>
    <span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">numeric_feats</span><span class="p">),</span>
    <span class="p">(</span><span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> <span class="n">category_feats</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">preprocessor</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ColumnTransformer(transformers=[(&#39;drop&#39;, &#39;drop&#39;, [&#39;song_title&#39;]),
                                (&#39;standardscaler&#39;, StandardScaler(),
                                 [&#39;time_signature&#39;, &#39;tempo&#39;, &#39;speechiness&#39;,
                                  &#39;danceability&#39;, &#39;instrumentalness&#39;, &#39;valence&#39;,
                                  &#39;loudness&#39;, &#39;liveness&#39;, &#39;mode&#39;, &#39;energy&#39;,
                                  &#39;acousticness&#39;, &#39;duration_ms&#39;]),
                                (&#39;onehotencoder&#39;,
                                 OneHotEncoder(handle_unknown=&#39;ignore&#39;,
                                               sparse=False),
                                 [&#39;key&#39;, &#39;artist&#39;])])
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="baseline-model">
<h2>Baseline model<a class="headerlink" href="#baseline-model" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dummy</span> <span class="o">=</span> <span class="n">DummyClassifier</span><span class="p">()</span>
<span class="n">baseline_pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">dummy</span><span class="p">)</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;dummy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span><span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">dummy</span><span class="p">),</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> 
                                             <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">scoring_metric</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dummy</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>fit_time</th>
      <td>0.033 (+/- 0.007)</td>
    </tr>
    <tr>
      <th>score_time</th>
      <td>0.020 (+/- 0.002)</td>
    </tr>
    <tr>
      <th>test_accuracy</th>
      <td>0.520 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>train_accuracy</th>
      <td>0.520 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>test_roc_auc</th>
      <td>0.500 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>train_roc_auc</th>
      <td>0.500 (+/- 0.000)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Accuracy of Dummy classifier depends on class ratio. As we have a balanced data set, the accuracy of Dummy classifier is around 50%.</p>
</div>
<div class="section" id="linear-models">
<h2>Linear models<a class="headerlink" href="#linear-models" title="Permalink to this headline">¶</a></h2>
<div class="section" id="model-training-logisticregression">
<h3>Model training - LogisticRegression<a class="headerlink" href="#model-training-logisticregression" title="Permalink to this headline">¶</a></h3>
<p>First, a linear model is used as a first real attempt. Hyperparameter tuning is also carried out for tuning to explore different values for the regularization hyperparameter. Cross-validation scores along with standard deviation and results summary is shown in below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#pipe logistic regression</span>
<span class="n">pipe_logisticregression</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span>
                           <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> 
                                             <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#save in the results logistic regression score</span>
<span class="n">results</span><span class="p">[</span><span class="s2">&quot;LogisticReg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span><span class="n">pipe_logisticregression</span><span class="p">,</span> 
                                                   <span class="n">X_train</span><span class="p">,</span> 
                                                   <span class="n">y_train</span><span class="p">,</span> 
                                                   <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                   <span class="n">scoring</span> <span class="o">=</span> <span class="n">scoring_metric</span><span class="p">,</span>
                                                   <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dummy</th>
      <th>LogisticReg</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>fit_time</th>
      <td>0.033 (+/- 0.007)</td>
      <td>1.462 (+/- 0.022)</td>
    </tr>
    <tr>
      <th>score_time</th>
      <td>0.020 (+/- 0.002)</td>
      <td>0.043 (+/- 0.006)</td>
    </tr>
    <tr>
      <th>test_accuracy</th>
      <td>0.520 (+/- 0.001)</td>
      <td>0.873 (+/- 0.009)</td>
    </tr>
    <tr>
      <th>train_accuracy</th>
      <td>0.520 (+/- 0.000)</td>
      <td>0.931 (+/- 0.003)</td>
    </tr>
    <tr>
      <th>test_roc_auc</th>
      <td>0.500 (+/- 0.000)</td>
      <td>0.950 (+/- 0.006)</td>
    </tr>
    <tr>
      <th>train_roc_auc</th>
      <td>0.500 (+/- 0.000)</td>
      <td>0.977 (+/- 0.001)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="hyperparameter-optimization">
<h3>hyperparameter optimization<a class="headerlink" href="#hyperparameter-optimization" title="Permalink to this headline">¶</a></h3>
<p>We will carry out hyperparameter optimization: C controls the regularization, and class_weight hyperparameter for tackling class imbalance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#parameters for logistic regression</span>
<span class="n">param_dist_lg</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;logisticregression__C&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
                 <span class="s1">&#39;logisticregression__class_weight&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;balanced&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">]}</span>

<span class="c1">#randomized search to find the best parameters</span>
<span class="n">random_search_lg</span> <span class="o">=</span> <span class="n">RandomizedSearchCV</span><span class="p">(</span>
    <span class="n">pipe_logisticregression</span><span class="p">,</span> 
    <span class="n">param_dist_lg</span><span class="p">,</span>
    <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">scoring</span> <span class="o">=</span> <span class="n">scoring_metric</span><span class="p">,</span>
    <span class="n">refit</span><span class="o">=</span><span class="s1">&#39;accuracy&#39;</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">random_search_lg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best parameter values are:&quot;</span><span class="p">,</span> <span class="n">random_search_lg</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best cv score is:&quot;</span><span class="p">,</span> <span class="n">random_search_lg</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;LogisticReg_opt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span><span class="n">random_search_lg</span><span class="p">,</span> 
                                                       <span class="n">X_train</span><span class="p">,</span> 
                                                       <span class="n">y_train</span><span class="p">,</span> 
                                                       <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                       <span class="n">scoring</span> <span class="o">=</span> <span class="n">scoring_metric</span><span class="p">,</span>
                                                       <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dummy</th>
      <th>LogisticReg</th>
      <th>LogisticReg_opt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>fit_time</th>
      <td>0.030 (+/- 0.007)</td>
      <td>0.369 (+/- 0.016)</td>
      <td>14.622 (+/- 1.540)</td>
    </tr>
    <tr>
      <th>score_time</th>
      <td>0.022 (+/- 0.008)</td>
      <td>0.027 (+/- 0.001)</td>
      <td>0.027 (+/- 0.003)</td>
    </tr>
    <tr>
      <th>test_accuracy</th>
      <td>0.520 (+/- 0.001)</td>
      <td>0.873 (+/- 0.009)</td>
      <td>0.887 (+/- 0.010)</td>
    </tr>
    <tr>
      <th>train_accuracy</th>
      <td>0.520 (+/- 0.000)</td>
      <td>0.931 (+/- 0.003)</td>
      <td>0.959 (+/- 0.004)</td>
    </tr>
    <tr>
      <th>test_roc_auc</th>
      <td>0.500 (+/- 0.000)</td>
      <td>0.950 (+/- 0.006)</td>
      <td>0.961 (+/- 0.004)</td>
    </tr>
    <tr>
      <th>train_roc_auc</th>
      <td>0.500 (+/- 0.000)</td>
      <td>0.977 (+/- 0.001)</td>
      <td>0.988 (+/- 0.002)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We can see that with optimized hyperparameters, Logistic Regression is doing a bit better. However, it is obvious that we are dealing with overfitting (big gap between test and training scores and the training accuracy is almost 100%). The std is very small ranging in +- 0.01.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span>
    <span class="n">classification_report</span><span class="p">(</span>
        <span class="n">y_train</span><span class="p">,</span>
        <span class="n">random_search_lg</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_train</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="n">target_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">],</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>              precision    recall  f1-score   support

           0       0.95      0.96      0.96      1838
           1       0.96      0.96      0.96      1993

    accuracy                           0.96      3831
   macro avg       0.96      0.96      0.96      3831
weighted avg       0.96      0.96      0.96      3831
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span>
    <span class="n">y_train</span><span class="p">,</span>
    <span class="n">random_search_lg</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_train</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">pos_label</span><span class="o">=</span><span class="n">random_search_lg</span><span class="o">.</span><span class="n">classes_</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Area under the curve (AUC): </span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">random_search_lg</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_train</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">roc_display</span> <span class="o">=</span> <span class="n">RocCurveDisplay</span><span class="p">(</span><span class="n">fpr</span><span class="o">=</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="o">=</span><span class="n">tpr</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Area under the curve (AUC): 0.989
</pre></div>
</div>
<img alt="_images/6_Machine_Learning_33_1.png" src="_images/6_Machine_Learning_33_1.png" />
</div>
</div>
<p>We have high score in AUC and classification report, which means our prediction model performance is good.</p>
</div>
<div class="section" id="model-interpretation-on-training-set">
<h3>Model interpretation on Training set<a class="headerlink" href="#model-interpretation-on-training-set" title="Permalink to this headline">¶</a></h3>
<p>Most important features are listed in below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">col_name_pp_all</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">*</span><span class="n">numeric_feats</span><span class="p">,</span>
    <span class="o">*</span><span class="n">random_search_lg</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;columntransformer&quot;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">named_transformers_</span><span class="p">[</span><span class="s2">&quot;onehotencoder&quot;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">(),</span>
<span class="p">]</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Importance&quot;</span><span class="p">:</span> <span class="n">random_search_lg</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span>
        <span class="s2">&quot;logisticregression&quot;</span>
    <span class="p">]</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<span class="p">}</span>
<span class="n">feat_importance</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">col_name_pp_all</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
    <span class="n">by</span><span class="o">=</span><span class="s2">&quot;Importance&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="n">feat_importance_200</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">feat_importance</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">99</span><span class="p">],</span> <span class="n">feat_importance</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">:]])</span>
<span class="n">feat_importance_200</span><span class="p">[</span><span class="s2">&quot;rank&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">feat_importance_200</span><span class="p">[</span><span class="s2">&quot;Importance&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">feat_importance_200</span><span class="p">[</span><span class="s2">&quot;side&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">feat_importance_200</span><span class="p">[</span><span class="s2">&quot;Importance&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;pos&quot;</span><span class="p">,</span> <span class="s2">&quot;neg&quot;</span>
<span class="p">)</span>
<span class="n">feat_importance_200</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Importance</th>
      <th>rank</th>
      <th>side</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>artist_FIDLAR</th>
      <td>4.557683</td>
      <td>1.0</td>
      <td>pos</td>
    </tr>
    <tr>
      <th>artist_Kanye West</th>
      <td>4.034912</td>
      <td>2.0</td>
      <td>pos</td>
    </tr>
    <tr>
      <th>artist_Crystal Castles</th>
      <td>4.017172</td>
      <td>3.0</td>
      <td>pos</td>
    </tr>
    <tr>
      <th>artist_Beach House</th>
      <td>4.015040</td>
      <td>4.0</td>
      <td>pos</td>
    </tr>
    <tr>
      <th>artist_Disclosure</th>
      <td>3.799238</td>
      <td>5.0</td>
      <td>pos</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>artist_*NSYNC</th>
      <td>-3.596354</td>
      <td>195.0</td>
      <td>neg</td>
    </tr>
    <tr>
      <th>artist_WALK THE MOON</th>
      <td>-3.766083</td>
      <td>196.0</td>
      <td>neg</td>
    </tr>
    <tr>
      <th>artist_Skrillex</th>
      <td>-3.874031</td>
      <td>197.0</td>
      <td>neg</td>
    </tr>
    <tr>
      <th>artist_Michael Jackson</th>
      <td>-3.897069</td>
      <td>198.0</td>
      <td>neg</td>
    </tr>
    <tr>
      <th>artist_Backstreet Boys</th>
      <td>-3.979357</td>
      <td>199.0</td>
      <td>neg</td>
    </tr>
  </tbody>
</table>
<p>199 rows × 3 columns</p>
</div></div></div>
</div>
<p>Most of the important features are determined by <code class="docutils literal notranslate"><span class="pre">artists</span></code>. Excluding all the features from artist, the other important features are <code class="docutils literal notranslate"><span class="pre">key</span></code>, <code class="docutils literal notranslate"><span class="pre">danceability</span></code> and <code class="docutils literal notranslate"><span class="pre">duration</span></code>. However, the ranking of importance are pretty low, starting from #423.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">feat_importance_reset</span> <span class="o">=</span> <span class="n">feat_importance</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">feat_importance_reset</span><span class="p">[</span><span class="n">feat_importance_reset</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;^(?![artist])&#39;</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>index</th>
      <th>Importance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>353</th>
      <td>danceability</td>
      <td>0.552342</td>
    </tr>
    <tr>
      <th>389</th>
      <td>key_9</td>
      <td>0.436209</td>
    </tr>
    <tr>
      <th>397</th>
      <td>key_4</td>
      <td>0.411787</td>
    </tr>
    <tr>
      <th>422</th>
      <td>key_2</td>
      <td>0.258068</td>
    </tr>
    <tr>
      <th>424</th>
      <td>key_10</td>
      <td>0.251043</td>
    </tr>
    <tr>
      <th>431</th>
      <td>key_6</td>
      <td>0.220164</td>
    </tr>
    <tr>
      <th>434</th>
      <td>duration_ms</td>
      <td>0.197986</td>
    </tr>
    <tr>
      <th>441</th>
      <td>liveness</td>
      <td>0.136481</td>
    </tr>
    <tr>
      <th>443</th>
      <td>valence</td>
      <td>0.097475</td>
    </tr>
    <tr>
      <th>446</th>
      <td>energy</td>
      <td>0.068914</td>
    </tr>
    <tr>
      <th>447</th>
      <td>key_11</td>
      <td>0.065221</td>
    </tr>
    <tr>
      <th>448</th>
      <td>key_5</td>
      <td>0.038536</td>
    </tr>
    <tr>
      <th>450</th>
      <td>key_8</td>
      <td>-0.025301</td>
    </tr>
    <tr>
      <th>452</th>
      <td>mode</td>
      <td>-0.092021</td>
    </tr>
    <tr>
      <th>454</th>
      <td>key_7</td>
      <td>-0.099948</td>
    </tr>
    <tr>
      <th>460</th>
      <td>loudness</td>
      <td>-0.206236</td>
    </tr>
    <tr>
      <th>463</th>
      <td>key_1</td>
      <td>-0.225751</td>
    </tr>
    <tr>
      <th>555</th>
      <td>key_0</td>
      <td>-0.554652</td>
    </tr>
    <tr>
      <th>706</th>
      <td>key_3</td>
      <td>-0.775756</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="k">as</span> <span class="nn">alt</span>

<span class="n">base</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">feat_importance_200</span><span class="o">.</span><span class="n">reset_index</span><span class="p">())</span>
    <span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span>
    <span class="o">.</span><span class="n">encode</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span>
            <span class="s2">&quot;index&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Importance:Q&quot;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;side&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Top 200 important features&quot;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">brush</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">selection_interval</span><span class="p">(</span><span class="n">encodings</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">])</span>
<span class="n">lower</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">base</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span>
            <span class="s2">&quot;index&quot;</span><span class="p">,</span>
            <span class="n">axis</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Features&quot;</span><span class="p">),</span>
            <span class="n">sort</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">SortField</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="s2">&quot;rank&quot;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;ascending&quot;</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Drag the plot in below to zoom&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_selection</span><span class="p">(</span><span class="n">brush</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">upper</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span>
        <span class="s2">&quot;index&quot;</span><span class="p">,</span>
        <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">brush</span><span class="p">),</span>
        <span class="n">axis</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">sort</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">SortField</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="s2">&quot;rank&quot;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;ascending&quot;</span><span class="p">),</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">upper</span> <span class="o">&amp;</span> <span class="n">lower</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<div id="altair-viz-41791aaa30564132bdd630f3e1d7a89b"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-41791aaa30564132bdd630f3e1d7a89b") {
      outputDiv = document.getElementById("altair-viz-41791aaa30564132bdd630f3e1d7a89b");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "vconcat": [{"mark": "bar", "encoding": {"color": {"field": "side", "type": "nominal"}, "x": {"axis": {"title": ""}, "field": "index", "scale": {"domain": {"selection": "selector001"}}, "sort": {"field": "rank", "order": "ascending"}, "type": "nominal"}, "y": {"field": "Importance", "type": "quantitative"}}, "height": 200, "title": "Top 200 important features", "width": 800}, {"mark": "bar", "encoding": {"color": {"field": "side", "type": "nominal"}, "x": {"axis": {"labels": false, "title": "Features"}, "field": "index", "sort": {"field": "rank", "order": "ascending"}, "type": "nominal"}, "y": {"field": "Importance", "type": "quantitative"}}, "height": 60, "selection": {"selector001": {"type": "interval", "encodings": ["x"]}}, "title": "Drag the plot in below to zoom", "width": 800}], "data": {"name": "data-adf903ce752dd2bfdf786163fac9bda0"}, "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json", "datasets": {"data-adf903ce752dd2bfdf786163fac9bda0": [{"index": "artist_FIDLAR", "Importance": 4.557682958329887, "rank": 1.0, "side": "pos"}, {"index": "artist_Kanye West", "Importance": 4.034912398562022, "rank": 2.0, "side": "pos"}, {"index": "artist_Crystal Castles", "Importance": 4.017171661763169, "rank": 3.0, "side": "pos"}, {"index": "artist_Beach House", "Importance": 4.015040410257645, "rank": 4.0, "side": "pos"}, {"index": "artist_Disclosure", "Importance": 3.7992376083135477, "rank": 5.0, "side": "pos"}, {"index": "artist_M83", "Importance": 3.763638434007246, "rank": 6.0, "side": "pos"}, {"index": "artist_CHVRCHES", "Importance": 3.7221428405036474, "rank": 7.0, "side": "pos"}, {"index": "artist_The Sonics", "Importance": 3.236269782562456, "rank": 8.0, "side": "pos"}, {"index": "artist_Perfume Genius", "Importance": 3.0836472283036263, "rank": 9.0, "side": "pos"}, {"index": "artist_Young Thug", "Importance": 3.0574632002607403, "rank": 10.0, "side": "pos"}, {"index": "artist_Autre Ne Veut", "Importance": 3.0388835131219194, "rank": 11.0, "side": "pos"}, {"index": "artist_ScHoolboy Q", "Importance": 2.9633358089812356, "rank": 12.0, "side": "pos"}, {"index": "artist_Leon Bridges", "Importance": 2.9261095040402436, "rank": 13.0, "side": "pos"}, {"index": "artist_Hot Chip", "Importance": 2.9083831691875788, "rank": 14.0, "side": "pos"}, {"index": "artist_Tame Impala", "Importance": 2.894412011102099, "rank": 15.0, "side": "pos"}, {"index": "artist_Teams vs. Star Slinger", "Importance": 2.888217462007609, "rank": 16.0, "side": "pos"}, {"index": "artist_Radiohead", "Importance": 2.8607545390625457, "rank": 17.0, "side": "pos"}, {"index": "artist_Purity Ring", "Importance": 2.8605947555227873, "rank": 18.0, "side": "pos"}, {"index": "artist_Ty Segall", "Importance": 2.8404535899708807, "rank": 19.0, "side": "pos"}, {"index": "artist_Washed Out", "Importance": 2.8361590949700135, "rank": 20.0, "side": "pos"}, {"index": "artist_Grimes", "Importance": 2.803208861312942, "rank": 21.0, "side": "pos"}, {"index": "artist_Duke Dumont", "Importance": 2.7934062763680063, "rank": 22.0, "side": "pos"}, {"index": "artist_Gary Clark Jr.", "Importance": 2.7223757993061235, "rank": 23.0, "side": "pos"}, {"index": "artist_The Ronettes", "Importance": 2.6631707600077523, "rank": 24.0, "side": "pos"}, {"index": "artist_Stormzy", "Importance": 2.605120818269488, "rank": 25.0, "side": "pos"}, {"index": "artist_Danny Brown", "Importance": 2.5795300908535537, "rank": 26.0, "side": "pos"}, {"index": "artist_Iamsu!", "Importance": 2.5387938122117615, "rank": 27.0, "side": "pos"}, {"index": "artist_New Order", "Importance": 2.536103139793367, "rank": 28.0, "side": "pos"}, {"index": "artist_Chief Keef", "Importance": 2.4997736991251616, "rank": 29.0, "side": "pos"}, {"index": "artist_Phantogram", "Importance": 2.4329640140185504, "rank": 30.0, "side": "pos"}, {"index": "artist_The Partysquad", "Importance": 2.4170206321111185, "rank": 31.0, "side": "pos"}, {"index": "artist_Angel Olsen", "Importance": 2.4054290204499416, "rank": 32.0, "side": "pos"}, {"index": "artist_Parquet Courts", "Importance": 2.4014765780579133, "rank": 33.0, "side": "pos"}, {"index": "artist_Sleigh Bells", "Importance": 2.3761939051072942, "rank": 34.0, "side": "pos"}, {"index": "artist_Neon Indian", "Importance": 2.3691685040970527, "rank": 35.0, "side": "pos"}, {"index": "artist_James Brown", "Importance": 2.3565361407887258, "rank": 36.0, "side": "pos"}, {"index": "artist_Best Coast", "Importance": 2.322148798449988, "rank": 37.0, "side": "pos"}, {"index": "artist_TR/ST", "Importance": 2.3144593213184215, "rank": 38.0, "side": "pos"}, {"index": "artist_Action Bronson", "Importance": 2.3023911593099977, "rank": 39.0, "side": "pos"}, {"index": "artist_Lykke Li", "Importance": 2.2631054948941864, "rank": 40.0, "side": "pos"}, {"index": "artist_A$AP Ferg", "Importance": 2.2607321731657275, "rank": 41.0, "side": "pos"}, {"index": "artist_Jamie xx", "Importance": 2.2293982562586967, "rank": 42.0, "side": "pos"}, {"index": "artist_Justice", "Importance": 2.209094674314559, "rank": 43.0, "side": "pos"}, {"index": "artist_Barrington Levy", "Importance": 2.186738645660485, "rank": 44.0, "side": "pos"}, {"index": "artist_Sky Ferreira", "Importance": 2.116045761791774, "rank": 45.0, "side": "pos"}, {"index": "artist_TV On The Radio", "Importance": 2.1083039556833527, "rank": 46.0, "side": "pos"}, {"index": "artist_Fetty Wap", "Importance": 2.092869478572716, "rank": 47.0, "side": "pos"}, {"index": "artist_The Chiffons", "Importance": 2.0783900002544504, "rank": 48.0, "side": "pos"}, {"index": "artist_Arcade Fire", "Importance": 2.034872541068936, "rank": 49.0, "side": "pos"}, {"index": "artist_Zapp", "Importance": 2.010516115566095, "rank": 50.0, "side": "pos"}, {"index": "artist_Matthew Dear", "Importance": 2.003856423593521, "rank": 51.0, "side": "pos"}, {"index": "artist_2 Chainz", "Importance": 1.9769383171752783, "rank": 52.0, "side": "pos"}, {"index": "artist_Wiley", "Importance": 1.9616343611166096, "rank": 53.0, "side": "pos"}, {"index": "artist_Jefferson Airplane", "Importance": 1.9545763463378882, "rank": 54.0, "side": "pos"}, {"index": "artist_ODESZA", "Importance": 1.8897624756742601, "rank": 55.0, "side": "pos"}, {"index": "artist_Hippie Sabotage", "Importance": 1.8808653591199458, "rank": 56.0, "side": "pos"}, {"index": "artist_Booba", "Importance": 1.8583559169320965, "rank": 57.0, "side": "pos"}, {"index": "artist_How To Dress Well", "Importance": 1.8426287944338795, "rank": 58.0, "side": "pos"}, {"index": "artist_Blood Orange", "Importance": 1.830392800376495, "rank": 59.0, "side": "pos"}, {"index": "artist_Three 6 Mafia", "Importance": 1.8256057282491749, "rank": 60.0, "side": "pos"}, {"index": "artist_Travis Scott", "Importance": 1.8197959053761743, "rank": 61.0, "side": "pos"}, {"index": "artist_Juicy J", "Importance": 1.81908010294679, "rank": 62.0, "side": "pos"}, {"index": "artist_Ebo Taylor", "Importance": 1.8167112202352351, "rank": 63.0, "side": "pos"}, {"index": "artist_GENER8ION", "Importance": 1.8156780567771842, "rank": 64.0, "side": "pos"}, {"index": "artist_Ezale", "Importance": 1.8116488303929448, "rank": 65.0, "side": "pos"}, {"index": "artist_Shabazz Palaces", "Importance": 1.80179906456638, "rank": 66.0, "side": "pos"}, {"index": "artist_Solange", "Importance": 1.7759942006131528, "rank": 67.0, "side": "pos"}, {"index": "artist_Passion Pit", "Importance": 1.7757541253045888, "rank": 68.0, "side": "pos"}, {"index": "artist_Twin Shadow", "Importance": 1.7734678037656337, "rank": 69.0, "side": "pos"}, {"index": "artist_A$AP Rocky", "Importance": 1.759986522503961, "rank": 70.0, "side": "pos"}, {"index": "artist_Ben Pearce", "Importance": 1.75648944738362, "rank": 71.0, "side": "pos"}, {"index": "artist_Cults", "Importance": 1.7394256749592978, "rank": 72.0, "side": "pos"}, {"index": "artist_SBTRKT", "Importance": 1.7364613316776738, "rank": 73.0, "side": "pos"}, {"index": "artist_Marvin Gaye", "Importance": 1.703836245878112, "rank": 74.0, "side": "pos"}, {"index": "artist_A-Trak", "Importance": 1.6978217615520774, "rank": 75.0, "side": "pos"}, {"index": "artist_Gayngs", "Importance": 1.688439785891468, "rank": 76.0, "side": "pos"}, {"index": "artist_Martin Solveig", "Importance": 1.678777291539134, "rank": 77.0, "side": "pos"}, {"index": "artist_Thundercat", "Importance": 1.6775179472164068, "rank": 78.0, "side": "pos"}, {"index": "artist_M.I.A.", "Importance": 1.6559994342690316, "rank": 79.0, "side": "pos"}, {"index": "artist_Future Islands", "Importance": 1.6436340150054674, "rank": 80.0, "side": "pos"}, {"index": "artist_The Districts", "Importance": 1.6090753493825911, "rank": 81.0, "side": "pos"}, {"index": "artist_T. P. Orchestre Poly-Rythmo", "Importance": 1.597684966266536, "rank": 82.0, "side": "pos"}, {"index": "artist_Small Black", "Importance": 1.5975268081449316, "rank": 83.0, "side": "pos"}, {"index": "artist_Miguel", "Importance": 1.5938229676786668, "rank": 84.0, "side": "pos"}, {"index": "artist_Baauer", "Importance": 1.5867167047340505, "rank": 85.0, "side": "pos"}, {"index": "artist_William Onyeabor", "Importance": 1.5852947339669865, "rank": 86.0, "side": "pos"}, {"index": "artist_Vampire Weekend", "Importance": 1.573130266859144, "rank": 87.0, "side": "pos"}, {"index": "artist_Cathedrals", "Importance": 1.5591487425426045, "rank": 88.0, "side": "pos"}, {"index": "artist_Childish Gambino", "Importance": 1.54614712759249, "rank": 89.0, "side": "pos"}, {"index": "artist_Bugzy Malone", "Importance": 1.5378337446971446, "rank": 90.0, "side": "pos"}, {"index": "artist_Memoryhouse", "Importance": 1.5358016825761136, "rank": 91.0, "side": "pos"}, {"index": "artist_Killer Mike", "Importance": 1.5341418987851108, "rank": 92.0, "side": "pos"}, {"index": "artist_AlunaGeorge", "Importance": 1.5313892662250232, "rank": 93.0, "side": "pos"}, {"index": "artist_The Seshen", "Importance": 1.5210593690944962, "rank": 94.0, "side": "pos"}, {"index": "artist_Jungle", "Importance": 1.5199561258248648, "rank": 95.0, "side": "pos"}, {"index": "artist_Hayden James", "Importance": 1.5151205974819593, "rank": 96.0, "side": "pos"}, {"index": "artist_Toro y Moi", "Importance": 1.5132775104170604, "rank": 97.0, "side": "pos"}, {"index": "artist_The Stooges", "Importance": 1.5125909802867985, "rank": 98.0, "side": "pos"}, {"index": "artist_Kate Boy", "Importance": 1.509522575302354, "rank": 99.0, "side": "pos"}, {"index": "artist_Mark Knight", "Importance": -1.2351286493203595, "rank": 100.0, "side": "neg"}, {"index": "artist_India.Arie", "Importance": -1.2360713454275987, "rank": 101.0, "side": "neg"}, {"index": "artist_Dimitri Vangelis & Wyman", "Importance": -1.2423351702613872, "rank": 102.0, "side": "neg"}, {"index": "artist_Piso 21", "Importance": -1.2503339706655756, "rank": 103.0, "side": "neg"}, {"index": "artist_Jess Glynne", "Importance": -1.265250921310788, "rank": 104.0, "side": "neg"}, {"index": "artist_Vato Gonzalez", "Importance": -1.2687637314650333, "rank": 105.0, "side": "neg"}, {"index": "artist_Porter Robinson", "Importance": -1.2793710763816009, "rank": 106.0, "side": "neg"}, {"index": "artist_Bassjackers", "Importance": -1.289370754029276, "rank": 107.0, "side": "neg"}, {"index": "artist_2 LIVE CREW", "Importance": -1.2949224922743108, "rank": 108.0, "side": "neg"}, {"index": "artist_Gwen Stefani", "Importance": -1.297153213126983, "rank": 109.0, "side": "neg"}, {"index": "artist_Tevin Campbell", "Importance": -1.3000377945533768, "rank": 110.0, "side": "neg"}, {"index": "artist_Mario", "Importance": -1.3042004681117185, "rank": 111.0, "side": "neg"}, {"index": "artist_MercyMe", "Importance": -1.3090389608059114, "rank": 112.0, "side": "neg"}, {"index": "artist_Franz Schubert", "Importance": -1.3184384612750046, "rank": 113.0, "side": "neg"}, {"index": "artist_OneRepublic", "Importance": -1.3240574368570892, "rank": 114.0, "side": "neg"}, {"index": "artist_Alok", "Importance": -1.3299960015383787, "rank": 115.0, "side": "neg"}, {"index": "artist_Standing Egg", "Importance": -1.3388755538104349, "rank": 116.0, "side": "neg"}, {"index": "artist_Ariana Grande", "Importance": -1.3509889268030697, "rank": 117.0, "side": "neg"}, {"index": "artist_Lady Gaga", "Importance": -1.3771070530976828, "rank": 118.0, "side": "neg"}, {"index": "artist_Ben Remember", "Importance": -1.3824903592775244, "rank": 119.0, "side": "neg"}, {"index": "artist_San Holo", "Importance": -1.3891618816460383, "rank": 120.0, "side": "neg"}, {"index": "artist_Chris Brown", "Importance": -1.4023560621239612, "rank": 121.0, "side": "neg"}, {"index": "artist_Ed Sheeran", "Importance": -1.4074951762638823, "rank": 122.0, "side": "neg"}, {"index": "artist_Vanilla Ice", "Importance": -1.4188642780906822, "rank": 123.0, "side": "neg"}, {"index": "artist_Janet Jackson", "Importance": -1.4314474013118559, "rank": 124.0, "side": "neg"}, {"index": "artist_Monica", "Importance": -1.4567615792965065, "rank": 125.0, "side": "neg"}, {"index": "artist_Carlos Vives", "Importance": -1.463868631734744, "rank": 126.0, "side": "neg"}, {"index": "artist_Alan Walker", "Importance": -1.4723275598671908, "rank": 127.0, "side": "neg"}, {"index": "artist_Reik", "Importance": -1.4736016008831168, "rank": 128.0, "side": "neg"}, {"index": "artist_Robert Schumann", "Importance": -1.4784474461807184, "rank": 129.0, "side": "neg"}, {"index": "artist_Eminem", "Importance": -1.483546518147042, "rank": 130.0, "side": "neg"}, {"index": "artist_Sebastian Yatra", "Importance": -1.5050892730490122, "rank": 131.0, "side": "neg"}, {"index": "artist_10cm", "Importance": -1.5086992217275175, "rank": 132.0, "side": "neg"}, {"index": "artist_Chris Lake", "Importance": -1.541389856237162, "rank": 133.0, "side": "neg"}, {"index": "artist_Lost Kings", "Importance": -1.5464108651251962, "rank": 134.0, "side": "neg"}, {"index": "artist_Jon McLaughlin", "Importance": -1.5464921960637519, "rank": 135.0, "side": "neg"}, {"index": "artist_Machine Gun Kelly", "Importance": -1.5467991526023173, "rank": 136.0, "side": "neg"}, {"index": "artist_Maroon 5", "Importance": -1.5500156868468438, "rank": 137.0, "side": "neg"}, {"index": "artist_Wisin", "Importance": -1.573059331035526, "rank": 138.0, "side": "neg"}, {"index": "artist_Savage Garden", "Importance": -1.5738070452610744, "rank": 139.0, "side": "neg"}, {"index": "artist_Bruno Mars", "Importance": -1.577482691136003, "rank": 140.0, "side": "neg"}, {"index": "artist_Kygo", "Importance": -1.5818316780139285, "rank": 141.0, "side": "neg"}, {"index": "artist_Maluma", "Importance": -1.5877540480633165, "rank": 142.0, "side": "neg"}, {"index": "artist_EDX", "Importance": -1.5998928107557135, "rank": 143.0, "side": "neg"}, {"index": "artist_CNCO", "Importance": -1.6181018971146248, "rank": 144.0, "side": "neg"}, {"index": "artist_Scott Hamilton", "Importance": -1.6435228879573252, "rank": 145.0, "side": "neg"}, {"index": "artist_Ozuna", "Importance": -1.6698136701579362, "rank": 146.0, "side": "neg"}, {"index": "artist_Robin Thicke", "Importance": -1.6823598809140234, "rank": 147.0, "side": "neg"}, {"index": "artist_Harry Styles", "Importance": -1.6855025309631355, "rank": 148.0, "side": "neg"}, {"index": "artist_5 Seconds of Summer", "Importance": -1.6996802180015573, "rank": 149.0, "side": "neg"}, {"index": "artist_David Guetta", "Importance": -1.705047200285266, "rank": 150.0, "side": "neg"}, {"index": "artist_Enrique Iglesias", "Importance": -1.7184467966542851, "rank": 151.0, "side": "neg"}, {"index": "artist_Diddy", "Importance": -1.7453393579169632, "rank": 152.0, "side": "neg"}, {"index": "artist_Hanson", "Importance": -1.7693567643171297, "rank": 153.0, "side": "neg"}, {"index": "artist_J Balvin", "Importance": -1.7951616562566342, "rank": 154.0, "side": "neg"}, {"index": "artist_Marshmello", "Importance": -1.8258560686718555, "rank": 155.0, "side": "neg"}, {"index": "artist_Hailee Steinfeld", "Importance": -1.9281226407861012, "rank": 156.0, "side": "neg"}, {"index": "artist_Victorious Cast", "Importance": -2.0191005840294944, "rank": 157.0, "side": "neg"}, {"index": "artist_Bea Miller", "Importance": -2.0520643732152095, "rank": 158.0, "side": "neg"}, {"index": "artist_Kaskade", "Importance": -2.0570778629292192, "rank": 159.0, "side": "neg"}, {"index": "artist_Little Mix", "Importance": -2.0736522853232398, "rank": 160.0, "side": "neg"}, {"index": "artist_Next", "Importance": -2.0767615442402647, "rank": 161.0, "side": "neg"}, {"index": "artist_Flo Rida", "Importance": -2.093680283387475, "rank": 162.0, "side": "neg"}, {"index": "artist_MOTi", "Importance": -2.1124038963258904, "rank": 163.0, "side": "neg"}, {"index": "artist_Britney Spears", "Importance": -2.1357801438024637, "rank": 164.0, "side": "neg"}, {"index": "artist_Adrian Lux", "Importance": -2.139286249831502, "rank": 165.0, "side": "neg"}, {"index": "artist_JoJo", "Importance": -2.1467759449577666, "rank": 166.0, "side": "neg"}, {"index": "artist_Shawn Mendes", "Importance": -2.1649041221236622, "rank": 167.0, "side": "neg"}, {"index": "artist_Wyclef Jean", "Importance": -2.216136657544768, "rank": 168.0, "side": "neg"}, {"index": "artist_Daddy Yankee", "Importance": -2.2332697844007483, "rank": 169.0, "side": "neg"}, {"index": "artist_Luis Fonsi", "Importance": -2.3019344657953797, "rank": 170.0, "side": "neg"}, {"index": "artist_deadmau5", "Importance": -2.355829779319882, "rank": 171.0, "side": "neg"}, {"index": "artist_Nicky Jam", "Importance": -2.37749441407609, "rank": 172.0, "side": "neg"}, {"index": "artist_Ne-Yo", "Importance": -2.4122844994009744, "rank": 173.0, "side": "neg"}, {"index": "artist_Pitbull", "Importance": -2.433847446480362, "rank": 174.0, "side": "neg"}, {"index": "artist_Wahlstedt", "Importance": -2.4707589362782767, "rank": 175.0, "side": "neg"}, {"index": "artist_Kim Walker-Smith", "Importance": -2.5338634170911143, "rank": 176.0, "side": "neg"}, {"index": "artist_Zac Brown Band", "Importance": -2.5622462998309197, "rank": 177.0, "side": "neg"}, {"index": "artist_Martin Garrix", "Importance": -2.5674512723005716, "rank": 178.0, "side": "neg"}, {"index": "artist_Owl City", "Importance": -2.622792387833988, "rank": 179.0, "side": "neg"}, {"index": "artist_Xscape", "Importance": -2.699176451124276, "rank": 180.0, "side": "neg"}, {"index": "artist_Boyz II Men", "Importance": -2.702059743920966, "rank": 181.0, "side": "neg"}, {"index": "artist_Afrojack", "Importance": -2.761312824057406, "rank": 182.0, "side": "neg"}, {"index": "artist_Usher", "Importance": -2.7810751429476475, "rank": 183.0, "side": "neg"}, {"index": "artist_Katy Perry", "Importance": -2.783643992925893, "rank": 184.0, "side": "neg"}, {"index": "artist_Toni Braxton", "Importance": -2.799536843709133, "rank": 185.0, "side": "neg"}, {"index": "artist_Nickelback", "Importance": -2.8386887976250117, "rank": 186.0, "side": "neg"}, {"index": "artist_Shakira", "Importance": -2.9296351723665057, "rank": 187.0, "side": "neg"}, {"index": "artist_Big Time Rush", "Importance": -3.162839636844421, "rank": 188.0, "side": "neg"}, {"index": "artist_Destiny's Child", "Importance": -3.1653008112212655, "rank": 189.0, "side": "neg"}, {"index": "artist_The Chainsmokers", "Importance": -3.2913626588789393, "rank": 190.0, "side": "neg"}, {"index": "artist_Demi Lovato", "Importance": -3.3800407800491326, "rank": 191.0, "side": "neg"}, {"index": "artist_Kina Grannis", "Importance": -3.494224822360758, "rank": 192.0, "side": "neg"}, {"index": "artist_J. Cole", "Importance": -3.5315371672351783, "rank": 193.0, "side": "neg"}, {"index": "artist_Fall Out Boy", "Importance": -3.5742754301407853, "rank": 194.0, "side": "neg"}, {"index": "artist_*NSYNC", "Importance": -3.5963540480065572, "rank": 195.0, "side": "neg"}, {"index": "artist_WALK THE MOON", "Importance": -3.7660833917063274, "rank": 196.0, "side": "neg"}, {"index": "artist_Skrillex", "Importance": -3.8740313009135794, "rank": 197.0, "side": "neg"}, {"index": "artist_Michael Jackson", "Importance": -3.8970688203403356, "rank": 198.0, "side": "neg"}, {"index": "artist_Backstreet Boys", "Importance": -3.9793570186336136, "rank": 199.0, "side": "neg"}]}}, {"mode": "vega-lite"});
</script></div></div>
</div>
<p>Top 200 most important features are based on artists.</p>
<p><br><br></p>
</div>
</div>
<div class="section" id="non-linear-models">
<h2>Non-linear models<a class="headerlink" href="#non-linear-models" title="Permalink to this headline">¶</a></h2>
<div class="section" id="model-training-randomforestclassifier-xgbclassifier-lgbmclassifier-catboostclassifier">
<h3>Model training - RandomForestClassifier, XGBClassifier, LGBMClassifier, CatBoostClassifier<a class="headerlink" href="#model-training-randomforestclassifier-xgbclassifier-lgbmclassifier-catboostclassifier" title="Permalink to this headline">¶</a></h3>
<p>Second, four non-linear model are trained aside from the linear model above.<br />
After that, feature selection and hyperparameter tuning will carried out in later stage. Cross-validation scores along with standard deviation and results summary is shown in below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Random Forest pipe</span>
<span class="n">pipe_rf</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">))</span>

<span class="c1"># XGBoost pipe</span>
<span class="n">pipe_xgb</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">preprocessor</span><span class="p">,</span>
    <span class="n">XGBClassifier</span><span class="p">(</span>
        <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">eval_metric</span><span class="o">=</span><span class="s2">&quot;logloss&quot;</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">use_label_encoder</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">),</span>
<span class="p">)</span>

<span class="c1"># LGBM Classifier pipe</span>
<span class="n">pipe_lgbm</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">LGBMClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">))</span>

<span class="c1"># Catboost pipe</span>
<span class="n">pipe_catb</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">CatBoostClassifier</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">))</span>

<span class="n">models</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;RandomForest&quot;</span><span class="p">:</span> <span class="n">pipe_rf</span><span class="p">,</span>
    <span class="s2">&quot;XGBoost&quot;</span><span class="p">:</span> <span class="n">pipe_xgb</span><span class="p">,</span>
    <span class="s2">&quot;LGBM&quot;</span><span class="p">:</span> <span class="n">pipe_lgbm</span><span class="p">,</span>
    <span class="s2">&quot;Cat_Boost&quot;</span><span class="p">:</span> <span class="n">pipe_catb</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># summarize mean cv scores in result_non_linear</span>
<span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">results</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span>
        <span class="n">model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">scoring_metric</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dummy</th>
      <th>LogisticReg</th>
      <th>LogisticReg_opt</th>
      <th>RandomForest</th>
      <th>XGBoost</th>
      <th>LGBM</th>
      <th>Cat_Boost</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>fit_time</th>
      <td>0.030 (+/- 0.007)</td>
      <td>0.369 (+/- 0.016)</td>
      <td>14.622 (+/- 1.540)</td>
      <td>0.964 (+/- 0.028)</td>
      <td>2.203 (+/- 0.164)</td>
      <td>0.153 (+/- 0.017)</td>
      <td>3.150 (+/- 0.202)</td>
    </tr>
    <tr>
      <th>score_time</th>
      <td>0.022 (+/- 0.008)</td>
      <td>0.027 (+/- 0.001)</td>
      <td>0.027 (+/- 0.003)</td>
      <td>0.075 (+/- 0.007)</td>
      <td>0.032 (+/- 0.001)</td>
      <td>0.023 (+/- 0.001)</td>
      <td>0.274 (+/- 0.017)</td>
    </tr>
    <tr>
      <th>test_accuracy</th>
      <td>0.520 (+/- 0.001)</td>
      <td>0.873 (+/- 0.009)</td>
      <td>0.887 (+/- 0.010)</td>
      <td>0.941 (+/- 0.010)</td>
      <td>0.937 (+/- 0.007)</td>
      <td>0.937 (+/- 0.006)</td>
      <td>0.930 (+/- 0.006)</td>
    </tr>
    <tr>
      <th>train_accuracy</th>
      <td>0.520 (+/- 0.000)</td>
      <td>0.931 (+/- 0.003)</td>
      <td>0.959 (+/- 0.004)</td>
      <td>0.997 (+/- 0.000)</td>
      <td>0.997 (+/- 0.000)</td>
      <td>0.996 (+/- 0.000)</td>
      <td>0.968 (+/- 0.002)</td>
    </tr>
    <tr>
      <th>test_roc_auc</th>
      <td>0.500 (+/- 0.000)</td>
      <td>0.950 (+/- 0.006)</td>
      <td>0.961 (+/- 0.004)</td>
      <td>0.989 (+/- 0.002)</td>
      <td>0.981 (+/- 0.005)</td>
      <td>0.981 (+/- 0.004)</td>
      <td>0.975 (+/- 0.003)</td>
    </tr>
    <tr>
      <th>train_roc_auc</th>
      <td>0.500 (+/- 0.000)</td>
      <td>0.977 (+/- 0.001)</td>
      <td>0.988 (+/- 0.002)</td>
      <td>1.000 (+/- 0.000)</td>
      <td>1.000 (+/- 0.000)</td>
      <td>1.000 (+/- 0.000)</td>
      <td>0.997 (+/- 0.001)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>All the non-linear models are overfitting as all the training scores are close to 1. Compared to most of the models, <code class="docutils literal notranslate"><span class="pre">CatBoost</span></code> is the most balanced model in performance, it has the highest accuracy and comparatively less overfitting (the gap between train and validation scores is smaller).</p>
<p>However, the fit time for<code class="docutils literal notranslate"><span class="pre">cat_boost</span></code> is slow. It may be a concern as the algorithm is likely to refit every user by the latest song listening history whenever the user wants to update their playlist. Moreover, the score time of <code class="docutils literal notranslate"><span class="pre">cat_boost</span></code> is the slowest among all models but acceptable.</p>
<p>Stability of scores is more or less stable, with standard deviation ranging in around 0.01.</p>
</div>
<div class="section" id="hyperparameter-optimization-very-time-consuming-tbc">
<h3>Hyperparameter optimization (Very time consuming, TBC)<a class="headerlink" href="#hyperparameter-optimization-very-time-consuming-tbc" title="Permalink to this headline">¶</a></h3>
<p>Hyperparamaters optimization is performed for <code class="docutils literal notranslate"><span class="pre">CatBoostClassifier</span></code>:<br />
<strong>max_depth</strong> which determines the the depth of the tree<br />
<strong>learning_rate</strong> which controls the gradient step size (smaller size, more iterations) and can help to minimize the error associated with the Loss function</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">param_grid_cat</span> <span class="o">=</span> <span class="p">{</span>
     <span class="s2">&quot;catboostclassifier__max_depth&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
     <span class="s2">&quot;catboostclassifier__learning_rate&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p><br><br></p>
</div>
<div class="section" id="id1">
<h3>Model interpretation on Training set<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Since <code class="docutils literal notranslate"><span class="pre">feature_importance_</span></code> is not supported on the models, <code class="docutils literal notranslate"><span class="pre">shap</span></code> is used to examine the most important features of our best non-linear models.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_catb</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train_enc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">preprocessor</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">),</span>
    <span class="n">columns</span><span class="o">=</span><span class="n">col_name_pp_all</span><span class="p">,</span>
    <span class="n">index</span><span class="o">=</span><span class="n">X_train</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">catboost_explainer</span> <span class="o">=</span> <span class="n">shap</span><span class="o">.</span><span class="n">TreeExplainer</span><span class="p">(</span><span class="n">pipe_catb</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;catboostclassifier&quot;</span><span class="p">])</span>
<span class="n">train_catboost_shap_values</span> <span class="o">=</span> <span class="n">catboost_explainer</span><span class="o">.</span><span class="n">shap_values</span><span class="p">(</span><span class="n">X_train_enc</span><span class="p">)</span>
<span class="n">shap</span><span class="o">.</span><span class="n">summary_plot</span><span class="p">(</span><span class="n">train_catboost_shap_values</span><span class="p">,</span> <span class="n">X_train_enc</span><span class="p">,</span> <span class="n">plot_type</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/6_Machine_Learning_57_0.png" src="_images/6_Machine_Learning_57_0.png" />
</div>
</div>
<p>We examined the most important features of <code class="docutils literal notranslate"><span class="pre">CatBoostClassifier</span></code> with SHAP methods. The results suggests that the most important feature are <code class="docutils literal notranslate"><span class="pre">instrumentalness</span></code>, <code class="docutils literal notranslate"><span class="pre">loudness</span></code> and <code class="docutils literal notranslate"><span class="pre">speechiness</span></code>. It introduced a very different results comparing to the linear model, which suggested <code class="docutils literal notranslate"><span class="pre">artist</span></code> is the most important features.</p>
<p>One interesting observation from the result here is that, the importance of <code class="docutils literal notranslate"><span class="pre">artist</span></code> suggested by two models are different too. Top 3 <code class="docutils literal notranslate"><span class="pre">artist</span></code> from linear model are <strong>FIDLAR</strong>, <strong>Beach House</strong>, <strong>Perfume Genius</strong>, while top 3 <code class="docutils literal notranslate"><span class="pre">artist</span></code> from linear model are <strong>Disclosure</strong>, <strong>Kanye West</strong> and <strong>Purity Ring</strong>. Nevertheless, all of the artists above are noticeable from EDA <strong>Artist like world cloud</strong>.</p>
</div>
</div>
<div class="section" id="model-averaging">
<h2>Model Averaging<a class="headerlink" href="#model-averaging" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">CatBoostClassifier</span></code> has long processing time but the other models are overfitted. To ease the fundamental trade off, <code class="docutils literal notranslate"><span class="pre">Averaging</span></code> is attempted to see if a higher validation score and shorter fit time can be achieved.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">avg_classifiers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;random forest&quot;</span><span class="p">:</span> <span class="n">pipe_rf</span><span class="p">,</span>
    <span class="s2">&quot;XGBoost&quot;</span><span class="p">:</span> <span class="n">pipe_xgb</span><span class="p">,</span>
    <span class="s2">&quot;LightGBM&quot;</span><span class="p">:</span> <span class="n">pipe_lgbm</span>
<span class="p">}</span>

<span class="n">averaging_model</span> <span class="o">=</span> <span class="n">VotingClassifier</span><span class="p">(</span>
    <span class="nb">list</span><span class="p">(</span><span class="n">avg_classifiers</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span> <span class="n">voting</span><span class="o">=</span><span class="s2">&quot;soft&quot;</span>
<span class="p">)</span> 

<span class="n">results</span><span class="p">[</span><span class="s1">&#39;averaging&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span>
        <span class="n">averaging_model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">scoring_metric</span><span class="c1">#, cv=2</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dummy</th>
      <th>LogisticReg</th>
      <th>LogisticReg_opt</th>
      <th>RandomForest</th>
      <th>XGBoost</th>
      <th>LGBM</th>
      <th>Cat_Boost</th>
      <th>averaging</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>fit_time</th>
      <td>0.030 (+/- 0.007)</td>
      <td>0.369 (+/- 0.016)</td>
      <td>14.622 (+/- 1.540)</td>
      <td>0.964 (+/- 0.028)</td>
      <td>2.203 (+/- 0.164)</td>
      <td>0.153 (+/- 0.017)</td>
      <td>3.150 (+/- 0.202)</td>
      <td>3.238 (+/- 0.247)</td>
    </tr>
    <tr>
      <th>score_time</th>
      <td>0.022 (+/- 0.008)</td>
      <td>0.027 (+/- 0.001)</td>
      <td>0.027 (+/- 0.003)</td>
      <td>0.075 (+/- 0.007)</td>
      <td>0.032 (+/- 0.001)</td>
      <td>0.023 (+/- 0.001)</td>
      <td>0.274 (+/- 0.017)</td>
      <td>0.100 (+/- 0.004)</td>
    </tr>
    <tr>
      <th>test_accuracy</th>
      <td>0.520 (+/- 0.001)</td>
      <td>0.873 (+/- 0.009)</td>
      <td>0.887 (+/- 0.010)</td>
      <td>0.941 (+/- 0.010)</td>
      <td>0.937 (+/- 0.007)</td>
      <td>0.937 (+/- 0.006)</td>
      <td>0.930 (+/- 0.006)</td>
      <td>0.940 (+/- 0.005)</td>
    </tr>
    <tr>
      <th>train_accuracy</th>
      <td>0.520 (+/- 0.000)</td>
      <td>0.931 (+/- 0.003)</td>
      <td>0.959 (+/- 0.004)</td>
      <td>0.997 (+/- 0.000)</td>
      <td>0.997 (+/- 0.000)</td>
      <td>0.996 (+/- 0.000)</td>
      <td>0.968 (+/- 0.002)</td>
      <td>0.997 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>test_roc_auc</th>
      <td>0.500 (+/- 0.000)</td>
      <td>0.950 (+/- 0.006)</td>
      <td>0.961 (+/- 0.004)</td>
      <td>0.989 (+/- 0.002)</td>
      <td>0.981 (+/- 0.005)</td>
      <td>0.981 (+/- 0.004)</td>
      <td>0.975 (+/- 0.003)</td>
      <td>0.989 (+/- 0.002)</td>
    </tr>
    <tr>
      <th>train_roc_auc</th>
      <td>0.500 (+/- 0.000)</td>
      <td>0.977 (+/- 0.001)</td>
      <td>0.988 (+/- 0.002)</td>
      <td>1.000 (+/- 0.000)</td>
      <td>1.000 (+/- 0.000)</td>
      <td>1.000 (+/- 0.000)</td>
      <td>0.997 (+/- 0.001)</td>
      <td>1.000 (+/- 0.000)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>According to the result, averaging the models neither help the overfitting issue nor scoring. However, the fit score is indeed faster than <code class="docutils literal notranslate"><span class="pre">Cat_Boost</span></code>. <code class="docutils literal notranslate"><span class="pre">CatBoostClassifier</span></code> is still the best model.</p>
</div>
<div class="section" id="results-on-the-test-set">
<h2>Results on the test set<a class="headerlink" href="#results-on-the-test-set" title="Permalink to this headline">¶</a></h2>
<p>The best performing model <code class="docutils literal notranslate"><span class="pre">CatBoostClassifier</span></code> is used on the test data and report test scores. Summary is shown as below. Furthermore, some test predictions and corresponding explanation with SHAP force plots are drawn for further study.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#predictions = pipe_catb.predict(X_test)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test Set accuracy: &quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">pipe_catb</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">),</span> <span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Test Set accuracy:  0.933
</pre></div>
</div>
</div>
</div>
<p>The test set’s score were slightly lower than the validation score. Therefore, the prediction is promising.</p>
<div class="section" id="interpretation-and-feature-importances-on-test-set">
<h3>Interpretation and feature importances on Test set<a class="headerlink" href="#interpretation-and-feature-importances-on-test-set" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Encoding X_test for SHAP force plot</span>
<span class="n">X_test_enc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">preprocessor</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">),</span>
    <span class="n">columns</span><span class="o">=</span><span class="n">col_name_pp_all</span><span class="p">,</span>
    <span class="n">index</span><span class="o">=</span><span class="n">X_test</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">X_test_enc</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(958, 960)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create an explainer for X_test_enc</span>
<span class="n">test_catboost_shap_values</span> <span class="o">=</span> <span class="n">catboost_explainer</span><span class="o">.</span><span class="n">shap_values</span><span class="p">(</span><span class="n">X_test_enc</span><span class="p">)</span>
<span class="n">shap</span><span class="o">.</span><span class="n">summary_plot</span><span class="p">(</span><span class="n">test_catboost_shap_values</span><span class="p">,</span> <span class="n">X_test_enc</span><span class="p">,</span> <span class="n">plot_type</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/6_Machine_Learning_68_0.png" src="_images/6_Machine_Learning_68_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_test</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Force Plot for prediction of 4th row (no_default)</span>
<span class="n">shap</span><span class="o">.</span><span class="n">force_plot</span><span class="p">(</span>
    <span class="n">catboost_explainer</span><span class="o">.</span><span class="n">expected_value</span><span class="p">,</span>
    <span class="n">test_catboost_shap_values</span><span class="p">[</span><span class="mi">3</span><span class="p">,:],</span>
    <span class="n">X_test_enc</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">3</span><span class="p">,:],</span>
    <span class="n">matplotlib</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/6_Machine_Learning_70_0.png" src="_images/6_Machine_Learning_70_0.png" />
</div>
</div>
<ul class="simple">
<li><p>As seen from the plot, the raw score is much smaller than the base value, which predict accurately as <strong>Unlike</strong> (class of ‘0’).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">speechiness</span></code> is pushing the prediction towards a higher score, and <code class="docutils literal notranslate"><span class="pre">instrumentalness</span></code> and <code class="docutils literal notranslate"><span class="pre">duration_ms</span></code> are pushing the prediction towards a lower score.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_test</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Force Plot for prediction of 2nd row (no_default)</span>
<span class="n">shap</span><span class="o">.</span><span class="n">force_plot</span><span class="p">(</span>
    <span class="n">catboost_explainer</span><span class="o">.</span><span class="n">expected_value</span><span class="p">,</span>
    <span class="n">test_catboost_shap_values</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span>
    <span class="n">X_test_enc</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span>
    <span class="n">matplotlib</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/6_Machine_Learning_73_0.png" src="_images/6_Machine_Learning_73_0.png" />
</div>
</div>
<ul class="simple">
<li><p>As seen from the plot, the raw score is much smaller than the base value, which predict accurately as <strong>Unlike</strong> (class of ‘0’).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">instrumentalness</span></code> and <code class="docutils literal notranslate"><span class="pre">duration_ms</span></code> are pushing the prediction towards a higher score, and <code class="docutils literal notranslate"><span class="pre">loudness</span></code> is pushing the prediction towards a lower score.</p></li>
</ul>
</div>
</div>
<div class="section" id="summary-of-machine-learning-results">
<h2>Summary of machine learning results<a class="headerlink" href="#summary-of-machine-learning-results" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dummy</th>
      <th>LogisticReg</th>
      <th>LogisticReg_opt</th>
      <th>RandomForest</th>
      <th>XGBoost</th>
      <th>LGBM</th>
      <th>Cat_Boost</th>
      <th>averaging</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>fit_time</th>
      <td>0.030 (+/- 0.007)</td>
      <td>0.369 (+/- 0.016)</td>
      <td>14.622 (+/- 1.540)</td>
      <td>0.964 (+/- 0.028)</td>
      <td>2.203 (+/- 0.164)</td>
      <td>0.153 (+/- 0.017)</td>
      <td>3.150 (+/- 0.202)</td>
      <td>3.238 (+/- 0.247)</td>
    </tr>
    <tr>
      <th>score_time</th>
      <td>0.022 (+/- 0.008)</td>
      <td>0.027 (+/- 0.001)</td>
      <td>0.027 (+/- 0.003)</td>
      <td>0.075 (+/- 0.007)</td>
      <td>0.032 (+/- 0.001)</td>
      <td>0.023 (+/- 0.001)</td>
      <td>0.274 (+/- 0.017)</td>
      <td>0.100 (+/- 0.004)</td>
    </tr>
    <tr>
      <th>test_accuracy</th>
      <td>0.520 (+/- 0.001)</td>
      <td>0.873 (+/- 0.009)</td>
      <td>0.887 (+/- 0.010)</td>
      <td>0.941 (+/- 0.010)</td>
      <td>0.937 (+/- 0.007)</td>
      <td>0.937 (+/- 0.006)</td>
      <td>0.930 (+/- 0.006)</td>
      <td>0.940 (+/- 0.005)</td>
    </tr>
    <tr>
      <th>train_accuracy</th>
      <td>0.520 (+/- 0.000)</td>
      <td>0.931 (+/- 0.003)</td>
      <td>0.959 (+/- 0.004)</td>
      <td>0.997 (+/- 0.000)</td>
      <td>0.997 (+/- 0.000)</td>
      <td>0.996 (+/- 0.000)</td>
      <td>0.968 (+/- 0.002)</td>
      <td>0.997 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>test_roc_auc</th>
      <td>0.500 (+/- 0.000)</td>
      <td>0.950 (+/- 0.006)</td>
      <td>0.961 (+/- 0.004)</td>
      <td>0.989 (+/- 0.002)</td>
      <td>0.981 (+/- 0.005)</td>
      <td>0.981 (+/- 0.004)</td>
      <td>0.975 (+/- 0.003)</td>
      <td>0.989 (+/- 0.002)</td>
    </tr>
    <tr>
      <th>train_roc_auc</th>
      <td>0.500 (+/- 0.000)</td>
      <td>0.977 (+/- 0.001)</td>
      <td>0.988 (+/- 0.002)</td>
      <td>1.000 (+/- 0.000)</td>
      <td>1.000 (+/- 0.000)</td>
      <td>1.000 (+/- 0.000)</td>
      <td>0.997 (+/- 0.001)</td>
      <td>1.000 (+/- 0.000)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;data/model_results.csv&#39;</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><br><br></p>
<p><br><br></p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="5_Feature_Engine.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Feature engineering</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="7_Conclusion.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Conclusion</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Macy Chan<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>