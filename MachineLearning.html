
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Machine Learning analysis &#8212; Spotify User Behaviour Predictor</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Exploratory data analysis" href="EDA.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Spotify User Behaviour Predictor</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Spotify User Behaviour Predictor
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="EDA.html">
   Exploratory data analysis
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Machine Learning analysis
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/MachineLearning.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/macychan/Spotify-user-behaviour-predictor"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/macychan/Spotify-user-behaviour-predictor/issues/new?title=Issue%20on%20page%20%2FMachineLearning.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/macychan/Spotify-user-behaviour-predictor/main?urlpath=tree/docs/MachineLearning.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reading-the-data-csv">
   2.1 Reading the data CSV
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-splitting">
   2.2 Data splitting
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#which-columns-to-include">
   2.7 Which columns to include?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercise-3-data-splitting-and-model-building-a-name-3-a">
   Exercise 3: Data splitting and model building
   <a name="3">
   </a>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#splitting-without-shuffling">
     3.1 Splitting without shuffling
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#splitting-with-shuffling">
     3.2 Splitting with shuffling
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#splitting-with-train-test-split">
     3.3 Splitting with
     <code class="docutils literal notranslate">
      <span class="pre">
       train_test_split
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#discussion">
     3.4 Discussion
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cross-validation">
     3.5 Cross-validation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#examining-cross-validation-scores">
     3.6 Examining cross-validation scores
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercise-4-hyperparameters-a-name-4-a">
   Exercise 4: Hyperparameters
   <a name="4">
   </a>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#train-and-cross-validation-plots">
     4.1 Train and cross-validation plots
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#max-depth-and-the-fundamental-tradeoff">
     4.2
     <code class="docutils literal notranslate">
      <span class="pre">
       max_depth
      </span>
     </code>
     and the fundamental tradeoff
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#picking-the-best-value-for-max-depth">
     4.3 Picking the best value for
     <code class="docutils literal notranslate">
      <span class="pre">
       max_depth
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#final-assessment-on-the-test-split">
     4.4 Final assessment on the test split
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#analysis">
     4.5 Analysis
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="machine-learning-analysis">
<h1>Machine Learning analysis<a class="headerlink" href="#machine-learning-analysis" title="Permalink to this headline">¶</a></h1>
<p>Kaggle’s <a class="reference external" href="https://www.kaggle.com/geomack/spotifyclassification/home">Spotify Song Attributes</a> dataset contains a number of features of songs from 2017 and a binary variable <code class="docutils literal notranslate"><span class="pre">target</span></code> that represents whether the user liked the song (encoded as 1) or not (encoded as 0). See the documentation of all the features <a class="reference external" href="https://developer.spotify.com/documentation/web-api/reference/tracks/get-audio-features/">here</a>.</p>
<div class="section" id="reading-the-data-csv">
<h2>2.1 Reading the data CSV<a class="headerlink" href="#reading-the-data-csv" title="Permalink to this headline">¶</a></h2>
<p>rubric={accuracy:3}</p>
<p>Read in the data CSV and store it as a pandas dataframe named <code class="docutils literal notranslate"><span class="pre">spotify_df</span></code>. The first column of the .csv file should be set as the index.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spotify_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">)</span>
<span class="n">spotify_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">zn</span><span class="o">/</span><span class="mi">40</span><span class="n">lvk7q11ddb7fryhn5vq7x80000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_45503</span><span class="o">/</span><span class="mf">581305263.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">spotify_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">spotify_df</span>

<span class="ne">NameError</span>: name &#39;pd&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p><br><br></p>
</div>
<div class="section" id="data-splitting">
<h2>2.2 Data splitting<a class="headerlink" href="#data-splitting" title="Permalink to this headline">¶</a></h2>
<p>rubric={accuracy:2}</p>
<p>Run the following line of code to split the data. How many training and test examples do we have?</p>
<blockquote>
<div><p>Note: we are setting the <code class="docutils literal notranslate"><span class="pre">random_state</span></code> so that everyone has the same split on their assignments. This will make it easier for the TAs to grade.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span><span class="p">,</span> <span class="n">test_df</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">spotify_df</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">train_df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">test_df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1613, 16)
(404, 16)
</pre></div>
</div>
</div>
</div>
<p>We have 1613 examples in training data, 404 examples in test data.</p>
<p>Yes, the difference between the features correlate to two target classes are used to distinguish whether the example should go to either one of the target classes. If two histograms are identical, no difference can be found, hence no useful information to distinguish between to target classes.</p>
</div>
<div class="section" id="which-columns-to-include">
<h2>2.7 Which columns to include?<a class="headerlink" href="#which-columns-to-include" title="Permalink to this headline">¶</a></h2>
<p>rubric={reasoning:4}</p>
<p><strong>Your tasks:</strong></p>
<p>Note that the dataset includes two free text features labeled <code class="docutils literal notranslate"><span class="pre">song_title</span></code> and <code class="docutils literal notranslate"><span class="pre">artist</span></code>. Do you think these features could be useful in predicting whether the user liked the song or not? Would there be any difficulty in using them in your model?</p>
<p><code class="docutils literal notranslate"><span class="pre">artist</span></code> can be useful in the prediction while <code class="docutils literal notranslate"><span class="pre">song_title</span></code> may be less useful. As many listeners may like the songs because of the artist, some popular singer like Taylor Swift, could be more favorable these days comparing to some older generation artists. However, song title may not be critical for user to like or dislike a song.<br />
Technically, DecisionTreeClassifier can handle text like categorical labels by treating them as <code class="docutils literal notranslate"><span class="pre">numeric</span></code>. But it will be difficulty to use since both <code class="docutils literal notranslate"><span class="pre">song_title</span></code> and <code class="docutils literal notranslate"><span class="pre">artist</span></code> are free text, which is not categorical labels with limited categories. The possible combinations are huge, hence hard to use them in the tree model.</p>
<p><br><br><br><br></p>
</div>
<div class="section" id="exercise-3-data-splitting-and-model-building-a-name-3-a">
<h2>Exercise 3: Data splitting and model building <a name="3"></a><a class="headerlink" href="#exercise-3-data-splitting-and-model-building-a-name-3-a" title="Permalink to this headline">¶</a></h2>
<hr>
Recall that in machine learning what we care about is generalization; we want to build models that generalize well on unseen examples. One way to approximate generalization error is by splitting the data into train and test splits, building and tuning the model only using the train split, and carrying out the final assessment on the test split. 
<p>In Exercise 2.2, we used <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code>’s <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.train_test_split.html">train_test_split</a> to split the data, which shuffles the data before splitting. In this exercise, we will try to convince ourselves the importance of shuffling before splitting.</p>
<p>The starter code below creates <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> for you to use in the following questions. In the exercises below, you’ll have to calculate <code class="docutils literal notranslate"><span class="pre">train</span></code> and <code class="docutils literal notranslate"><span class="pre">test</span></code> scores several times. To make it a bit easy for you, I am providing you a function <code class="docutils literal notranslate"><span class="pre">fit_and_report</span></code> below, which fits a model and prints train and test scores. Feel free to use this function in the following exercises.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">spotify_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;song_title&quot;</span><span class="p">,</span> <span class="s2">&quot;artist&quot;</span><span class="p">,</span> <span class="s2">&quot;target&quot;</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">spotify_df</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fit_and_report</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fits a given model on the training data and prints train and</span>
<span class="sd">    test scores.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    model: sklearn classifier model</span>
<span class="sd">        The sklearn model</span>
<span class="sd">    X_train: numpy.ndarray</span>
<span class="sd">        The X_train part of the data</span>
<span class="sd">    y_train: numpy.ndarray</span>
<span class="sd">        The y_train part of the data</span>
<span class="sd">    X_test: numpy.ndarray</span>
<span class="sd">        The X_train part of the data</span>
<span class="sd">    y_test: numpy.ndarray</span>
<span class="sd">        The y_test part of the data</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training score: </span><span class="si">%0.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test score: </span><span class="si">%0.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<p><br><br></p>
<div class="section" id="splitting-without-shuffling">
<h3>3.1 Splitting without shuffling<a class="headerlink" href="#splitting-without-shuffling" title="Permalink to this headline">¶</a></h3>
<p>rubric={accuracy:4}</p>
<p>The dataset has total 2,017 examples.</p>
<p><strong>Your tasks:</strong></p>
<ol class="simple">
<li><p>Split <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> as follows:</p>
<ul class="simple">
<li><p>Use the first 1500 rows as the train set (<code class="docutils literal notranslate"><span class="pre">X_train</span></code> and <code class="docutils literal notranslate"><span class="pre">y_train</span></code>)</p></li>
<li><p>Use the remaining rows as the test set (<code class="docutils literal notranslate"><span class="pre">X_test</span></code> and <code class="docutils literal notranslate"><span class="pre">y_test</span></code>)</p></li>
</ul>
</li>
<li><p>Train <code class="docutils literal notranslate"><span class="pre">DummyClassifier</span></code> on the train set and score it on the train and test sets.</p></li>
<li><p>Now train the <code class="docutils literal notranslate"><span class="pre">DecisionTreeClassifier</span></code> with <code class="docutils literal notranslate"><span class="pre">random_state=123</span></code> on the train set and score it on the train and test sets.</p></li>
</ol>
<blockquote>
<div><p>You may use the <code class="docutils literal notranslate"><span class="pre">fit_and_report</span></code> function above to <code class="docutils literal notranslate"><span class="pre">fit</span></code> and <code class="docutils literal notranslate"><span class="pre">score</span></code> models.</p>
</div></blockquote>
<blockquote>
<div><p>If parameter values are not specified explicitly, you may use the default values.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">1500</span><span class="p">,:],</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1500</span><span class="p">:,:]</span>
<span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">1500</span><span class="p">,],</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1500</span><span class="p">:,]</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DummyClassifier:&#39;</span><span class="p">)</span>
<span class="n">model_dummy</span> <span class="o">=</span> <span class="n">DummyClassifier</span><span class="p">()</span>
<span class="n">fit_and_report</span><span class="p">(</span><span class="n">model_dummy</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DecisionTreeClassifier:&#39;</span><span class="p">)</span>
<span class="n">model_tree</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
<span class="n">fit_and_report</span><span class="p">(</span><span class="n">model_tree</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DummyClassifier:
Training score: 0.680
Test score: 0.000
DecisionTreeClassifier:
Training score: 0.998
Test score: 0.491
</pre></div>
</div>
</div>
</div>
<p><br><br></p>
</div>
<div class="section" id="splitting-with-shuffling">
<h3>3.2 Splitting with shuffling<a class="headerlink" href="#splitting-with-shuffling" title="Permalink to this headline">¶</a></h3>
<p>rubric={accuracy:4}</p>
<p>The problem in the previous exercise was that we did not shuffle the training examples before splitting. Let’s see if shuffling the data improves the test score.</p>
<p><strong>Your tasks:</strong></p>
<ol class="simple">
<li><p>Run the starter code below to shuffle <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code>.</p></li>
<li><p>Split the <strong>shuffled data</strong> as follows:</p>
<ul class="simple">
<li><p>Use the first 1500 rows as the train set</p></li>
<li><p>Use the remaining rows as the test set</p></li>
</ul>
</li>
<li><p>Train <code class="docutils literal notranslate"><span class="pre">DummyClassifier</span></code> on the train set and score it on the train and test sets.</p></li>
<li><p>Now train the <code class="docutils literal notranslate"><span class="pre">DecisionTreeClassifier</span></code> with <code class="docutils literal notranslate"><span class="pre">random_state=123</span></code> on the train set and score it on the train and test sets.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_shuffled</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
<span class="n">y_shuffled</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">X_shuffled</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span> <span class="o">=</span> <span class="n">X_shuffled</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">1500</span><span class="p">,:],</span> <span class="n">X_shuffled</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1500</span><span class="p">:,:]</span>
<span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">y_shuffled</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">1500</span><span class="p">,],</span> <span class="n">y_shuffled</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1500</span><span class="p">:,]</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DummyClassifier:&#39;</span><span class="p">)</span>
<span class="n">model_dummy</span> <span class="o">=</span> <span class="n">DummyClassifier</span><span class="p">()</span>
<span class="n">fit_and_report</span><span class="p">(</span><span class="n">model_dummy</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DecisionTreeClassifier:&#39;</span><span class="p">)</span>
<span class="n">model_tree</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
<span class="n">fit_and_report</span><span class="p">(</span><span class="n">model_tree</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DummyClassifier:
Training score: 0.510
Test score: 0.493
DecisionTreeClassifier:
Training score: 0.999
Test score: 0.662
</pre></div>
</div>
</div>
</div>
<p><br><br></p>
</div>
<div class="section" id="splitting-with-train-test-split">
<h3>3.3 Splitting with <code class="docutils literal notranslate"><span class="pre">train_test_split</span></code><a class="headerlink" href="#splitting-with-train-test-split" title="Permalink to this headline">¶</a></h3>
<p>rubric={accuracy:4}</p>
<p><strong>Your tasks:</strong></p>
<ol class="simple">
<li><p>Now split the Spotify dataset into a 80% train and 20% test using <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.train_test_split.html"><code class="docutils literal notranslate"><span class="pre">train_test_split</span></code></a> with <code class="docutils literal notranslate"><span class="pre">random_state=123</span></code>.</p></li>
<li><p>Train <code class="docutils literal notranslate"><span class="pre">DummyClassifier</span></code> on the train set and score it on the train and test sets.</p></li>
<li><p>Train the <code class="docutils literal notranslate"><span class="pre">DecisionTreeClassifier</span></code> with <code class="docutils literal notranslate"><span class="pre">random_state=123</span></code> on the train set and score it on the train and test sets.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DummyClassifier:&#39;</span><span class="p">)</span>
<span class="n">model_dummy</span> <span class="o">=</span> <span class="n">DummyClassifier</span><span class="p">()</span>
<span class="n">fit_and_report</span><span class="p">(</span><span class="n">model_dummy</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DecisionTreeClassifier:&#39;</span><span class="p">)</span>
<span class="n">model_tree</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
<span class="n">fit_and_report</span><span class="p">(</span><span class="n">model_tree</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DummyClassifier:
Training score: 0.508
Test score: 0.498
DecisionTreeClassifier:
Training score: 0.999
Test score: 0.688
</pre></div>
</div>
</div>
</div>
<p><br><br></p>
</div>
<div class="section" id="discussion">
<h3>3.4 Discussion<a class="headerlink" href="#discussion" title="Permalink to this headline">¶</a></h3>
<p>rubric={reasoning:4}</p>
<p><strong>Your tasks:</strong></p>
<ol class="simple">
<li><p>Why do you think we got a lower test accuracy on the Spotify Song Attributes datasets when we did not shuffle the data before splitting compared to when we shuffled the data before splitting?</p></li>
<li><p>Do you expect <code class="docutils literal notranslate"><span class="pre">DummyClassifier</span></code> to be sensitive to data shuffling and splitting? Why or why not?</p></li>
</ol>
<ol class="simple">
<li><p>When a dataset is provided, it might be sorted, which makes the data has bias if we do not pick our data randomly. We want a set of training data that can represent the whole data set, therefore, shuffling is necessary.</p></li>
<li><p>Yes, it is very sensitive to shuffling and splitting. Since DummyClassifier only look at the frequency of y, if y is sorted, or not randomly distributed, the model will have bias. In our example, most of the ones are at the top of the data set while zeros at the bottom, when we count the training data without shuffle, naturally the model will predict 1 for all cases, and fail when we apply it to test data.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    1
1    1
2    1
3    1
4    1
Name: target, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2012    0
2013    0
2014    0
2015    0
2016    0
Name: target, dtype: int64
</pre></div>
</div>
</div>
</div>
<p><br><br></p>
</div>
<div class="section" id="cross-validation">
<h3>3.5 Cross-validation<a class="headerlink" href="#cross-validation" title="Permalink to this headline">¶</a></h3>
<p>rubric={accuracy:4}</p>
<p><strong>Your tasks:</strong></p>
<p>Carry out 10-fold cross validation using <code class="docutils literal notranslate"><span class="pre">cross_validate</span></code> on <code class="docutils literal notranslate"><span class="pre">X_train</span></code> and <code class="docutils literal notranslate"><span class="pre">y_train</span></code> from Exercise 3.3 by passing <code class="docutils literal notranslate"><span class="pre">return_train_score=True</span></code>. Display the results as a pandas dataframe.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cross_validate</span><span class="p">(</span><span class="n">model_tree</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="n">scores</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.018726</td>
      <td>0.002628</td>
      <td>0.722222</td>
      <td>0.999311</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.019385</td>
      <td>0.003403</td>
      <td>0.660494</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.016185</td>
      <td>0.001994</td>
      <td>0.660494</td>
      <td>0.999311</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.017209</td>
      <td>0.001832</td>
      <td>0.677019</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.015630</td>
      <td>0.001782</td>
      <td>0.695652</td>
      <td>0.999311</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.016298</td>
      <td>0.001808</td>
      <td>0.652174</td>
      <td>0.999311</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.014877</td>
      <td>0.001813</td>
      <td>0.658385</td>
      <td>0.999311</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.014943</td>
      <td>0.001601</td>
      <td>0.608696</td>
      <td>0.999311</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.014754</td>
      <td>0.002051</td>
      <td>0.683230</td>
      <td>0.999311</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.015762</td>
      <td>0.001740</td>
      <td>0.695652</td>
      <td>0.999311</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><br><br></p>
</div>
<div class="section" id="examining-cross-validation-scores">
<h3>3.6 Examining cross-validation scores<a class="headerlink" href="#examining-cross-validation-scores" title="Permalink to this headline">¶</a></h3>
<p>rubric={reasoning:5}</p>
<p><strong>Your tasks:</strong></p>
<ol class="simple">
<li><p>Inspect the 10 sub-scores from the 10 folds of cross-validation. How does this inform the trustworthiness of your mean cross-validation score?</p></li>
<li><p>Do you see a significant difference between the training scores and the cross-validation scores? Briefly discuss in 1 to 2 sentences.</p></li>
</ol>
<ol class="simple">
<li><p>Not trustworthy. The range of validation score is large, from 0.62 to 0.75 (different &gt; 0.12), which indicates that by changing the combination of validation and training data, it can vary. It is not trustworthy because of the steadiness.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scores</span><span class="p">[</span><span class="s1">&#39;test_score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="n">scores</span><span class="p">[</span><span class="s1">&#39;test_score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.11352657004830913
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scores_melt</span> <span class="o">=</span> <span class="n">scores</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span>
    <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fit_time&quot;</span><span class="p">,</span> <span class="s2">&quot;score_time&quot;</span><span class="p">],</span> <span class="n">var_name</span><span class="o">=</span><span class="s2">&quot;score_type&quot;</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">&quot;score&quot;</span>
<span class="p">)</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;score_type == &quot;test_score&quot;&#39;</span><span class="p">)</span>
<span class="n">test_score_boxplot</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">scores_melt</span><span class="p">)</span>
    <span class="o">.</span><span class="n">mark_boxplot</span><span class="p">()</span>
    <span class="o">.</span><span class="n">encode</span><span class="p">(</span>
        <span class="n">y</span><span class="o">=</span><span class="s2">&quot;score_type&quot;</span><span class="p">,</span>
        <span class="n">x</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">&quot;score&quot;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="p">[</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])),</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;score_type&quot;</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">test_score_boxplot</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<div id="altair-viz-503170ea1aac43158ce5873d9e25a3e0"></div>
<script type="text/javascript">
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-503170ea1aac43158ce5873d9e25a3e0") {
      outputDiv = document.getElementById("altair-viz-503170ea1aac43158ce5873d9e25a3e0");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.8.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function loadScript(lib) {
      return new Promise(function(resolve, reject) {
        var s = document.createElement('script');
        s.src = paths[lib];
        s.async = true;
        s.onload = () => resolve(paths[lib]);
        s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
        document.getElementsByTagName("head")[0].appendChild(s);
      });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else if (typeof vegaEmbed === "function") {
      displayChart(vegaEmbed);
    } else {
      loadScript("vega")
        .then(() => loadScript("vega-lite"))
        .then(() => loadScript("vega-embed"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "data": {"name": "data-dd5ed9ca7d16e64442f1ebf17dc4e6cf"}, "mark": "boxplot", "encoding": {"color": {"type": "nominal", "field": "score_type"}, "x": {"type": "quantitative", "field": "score", "scale": {"domain": [0.6, 0.8]}}, "y": {"type": "nominal", "field": "score_type"}}, "$schema": "https://vega.github.io/schema/vega-lite/v4.8.1.json", "datasets": {"data-dd5ed9ca7d16e64442f1ebf17dc4e6cf": [{"fit_time": 0.018725872039794922, "score_time": 0.0026280879974365234, "score_type": "test_score", "score": 0.7222222222222222}, {"fit_time": 0.01938486099243164, "score_time": 0.0034029483795166016, "score_type": "test_score", "score": 0.6604938271604939}, {"fit_time": 0.01618504524230957, "score_time": 0.0019941329956054688, "score_type": "test_score", "score": 0.6604938271604939}, {"fit_time": 0.01720905303955078, "score_time": 0.0018320083618164062, "score_type": "test_score", "score": 0.6770186335403726}, {"fit_time": 0.01562976837158203, "score_time": 0.0017821788787841797, "score_type": "test_score", "score": 0.6956521739130435}, {"fit_time": 0.01629805564880371, "score_time": 0.0018079280853271484, "score_type": "test_score", "score": 0.6521739130434783}, {"fit_time": 0.014877080917358398, "score_time": 0.0018129348754882812, "score_type": "test_score", "score": 0.6583850931677019}, {"fit_time": 0.01494288444519043, "score_time": 0.0016009807586669922, "score_type": "test_score", "score": 0.6086956521739131}, {"fit_time": 0.014754056930541992, "score_time": 0.0020508766174316406, "score_type": "test_score", "score": 0.6832298136645962}, {"fit_time": 0.0157620906829834, "score_time": 0.0017399787902832031, "score_type": "test_score", "score": 0.6956521739130435}]}}, {"mode": "vega-lite"});
</script></div></div>
</div>
<ol class="simple">
<li><p>Yes, the difference between training mean and cross-validation mean is large, while training mean is close to 1, the cross-validation mean is only 0.66. It indicates that the model is overfitting.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scores</span><span class="p">[</span><span class="s1">&#39;test_score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.6714017329959358
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scores</span><span class="p">[</span><span class="s1">&#39;train_score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.9994489408843148
</pre></div>
</div>
</div>
</div>
<p><br><br><br><br></p>
</div>
</div>
<div class="section" id="exercise-4-hyperparameters-a-name-4-a">
<h2>Exercise 4: Hyperparameters <a name="4"></a><a class="headerlink" href="#exercise-4-hyperparameters-a-name-4-a" title="Permalink to this headline">¶</a></h2>
<hr><div class="section" id="train-and-cross-validation-plots">
<h3>4.1 Train and cross-validation plots<a class="headerlink" href="#train-and-cross-validation-plots" title="Permalink to this headline">¶</a></h3>
<p>rubric={accuracy:12}</p>
<p>In this exercise, you’ll experiment with the <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> hyperparameter of the decision tree classifier. See the <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.tree.DecisionTreeClassifier.html"><code class="docutils literal notranslate"><span class="pre">DecisionTreeClassifier</span></code> documentation</a> for more details.</p>
<p><strong>Your tasks:</strong></p>
<ol class="simple">
<li><p>Just to start fresh, split the Spotify dataset into a 80% train and 20% test subset using <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.train_test_split.html"><code class="docutils literal notranslate"><span class="pre">sklearn.model_selection.train_test_split</span></code></a> and <code class="docutils literal notranslate"><span class="pre">random_state=123</span></code>.</p></li>
<li><p>Explore the <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> hyperparameter. Run 10-fold cross-validation for trees with different values of <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> (at least 10 different values in the range 1 to 25).</p></li>
<li><p>For each <code class="docutils literal notranslate"><span class="pre">max_depth</span></code>, get both the train accuracy and the cross-validation accuracy.</p></li>
<li><p>Make a plot with <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> on the <em>x</em>-axis and the train and cross-validation scores on the <em>y</em>-axis. That is, your plot should have two curves, one for train and one for cross-validation. Include a legend to specify which is which.</p></li>
</ol>
<blockquote>
<div><p>You may use whatever tool you like for plotting. We also have done something similar in lecture 2, and you may adapt that code to answer this question.</p>
</div></blockquote>
<blockquote>
<div><p>Note: generally speaking (for all assignments) you are welcome to copy/paste code directly from the lecture notes, though I ask that you add a small citation (e.g. “Adapted from lecture 2”) if you do so.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span>
<span class="p">)</span>

<span class="n">result_dict</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;depth&quot;</span><span class="p">,</span> <span class="s2">&quot;mean_cv_score&quot;</span><span class="p">,</span> <span class="s2">&quot;mean_train_score&quot;</span><span class="p">])</span>
<span class="k">for</span> <span class="n">depth</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">25</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="n">depth</span><span class="p">)</span>
    <span class="n">score</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">result_dict</span> <span class="o">=</span> <span class="n">result_dict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;depth&quot;</span><span class="p">:</span> <span class="n">depth</span><span class="p">,</span>
            <span class="s2">&quot;mean_cv_score&quot;</span><span class="p">:</span> <span class="n">score</span><span class="p">[</span><span class="s2">&quot;test_score&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
            <span class="s2">&quot;mean_train_score&quot;</span><span class="p">:</span> <span class="n">score</span><span class="p">[</span><span class="s2">&quot;train_score&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
        <span class="p">},</span>
        <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>

<span class="n">result_dict</span><span class="p">[</span><span class="s2">&quot;depth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result_dict</span><span class="p">[</span><span class="s2">&quot;depth&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
<span class="n">result_dict</span> <span class="o">=</span> <span class="n">result_dict</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;depth&quot;</span><span class="p">)</span>
<span class="n">result_dict</span><span class="p">[[</span><span class="s2">&quot;mean_cv_score&quot;</span><span class="p">,</span> <span class="s2">&quot;mean_train_score&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;depth&#39;&gt;
</pre></div>
</div>
<img alt="_images/MachineLearning_43_1.png" src="_images/MachineLearning_43_1.png" />
</div>
</div>
</div>
<div class="section" id="max-depth-and-the-fundamental-tradeoff">
<h3>4.2 <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> and the fundamental tradeoff<a class="headerlink" href="#max-depth-and-the-fundamental-tradeoff" title="Permalink to this headline">¶</a></h3>
<p>rubric={reasoning:2}</p>
<p><strong>Your tasks:</strong></p>
<ol class="simple">
<li><p>Discuss how changing the <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> hyperparameter affects the training and cross-validation accuracy.</p></li>
</ol>
<p>For training accuracy, it starts at low accuracy. When <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> increases, training accuracy increases and gets closer to 1. It is because more branches are used to evaluate examples.<br />
For cross-validation accuracy, it starts at low accuracy where it is similar to training accuracy. When <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> increases, cross-validation accuracy increases. However, at depth equal to 4, it turns and start decreasing. The differences between training accuracy and cross-validation accuracy also grow after that.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result_dict</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean_cv_score</th>
      <th>mean_train_score</th>
    </tr>
    <tr>
      <th>depth</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0.642926</td>
      <td>0.650686</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.692520</td>
      <td>0.711718</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.694387</td>
      <td>0.732797</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.724139</td>
      <td>0.768066</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.716678</td>
      <td>0.793691</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><br><br></p>
</div>
<div class="section" id="picking-the-best-value-for-max-depth">
<h3>4.3 Picking the best value for <code class="docutils literal notranslate"><span class="pre">max_depth</span></code><a class="headerlink" href="#picking-the-best-value-for-max-depth" title="Permalink to this headline">¶</a></h3>
<p>rubric={reasoning:3}</p>
<p><strong>Your tasks:</strong></p>
<ol class="simple">
<li><p>From these results, what value for <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> would you pick as the optimal value?</p></li>
</ol>
<p>The optimal value of <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> is 4, which has highest cross-validation accuracy and closest to raining accuracy.</p>
<p><br><br></p>
</div>
<div class="section" id="final-assessment-on-the-test-split">
<h3>4.4 Final assessment on the test split<a class="headerlink" href="#final-assessment-on-the-test-split" title="Permalink to this headline">¶</a></h3>
<p>rubric={accuracy:3}</p>
<ol class="simple">
<li><p>Train a decision tree classifier using the optimal <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> you chose in the previous exercise on the <em>entire training set</em>.</p></li>
<li><p>Compute and display the test score.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_spotify_max4</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">model_spotify_max4</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">score_spotify_max4</span> <span class="o">=</span> <span class="n">model_spotify_max4</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">score_spotify_max4</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.7619342839429635
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">fit_and_report</span><span class="p">(</span><span class="n">model_spotify_max4</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training score: 0.762
Test score: 0.678
None
</pre></div>
</div>
</div>
</div>
<p><br><br></p>
</div>
<div class="section" id="analysis">
<h3>4.5 Analysis<a class="headerlink" href="#analysis" title="Permalink to this headline">¶</a></h3>
<p>rubric={reasoning:5}</p>
<ol class="simple">
<li><p>How do the test scores compare to the cross-validation scores? Briefly discuss.</p></li>
<li><p>Why can’t you simply pick the value of <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> that gives the best accuracy on the training data? (Answer in maximum 2 to 3 sentences.)</p></li>
<li><p>Do you think that the <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> you chose would generalize to other “spotify” datasets (i.e., data on other spotify users)?</p></li>
</ol>
<ol class="simple">
<li><p>Test scores and cross-validation scores are similar. Both are using the same set of data, while we take the mean of all the cross-validation scores, we also calculate the test scores at once using the full set of training data. Mathematically, the results should be similar.</p></li>
<li><p>When <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> is high, the model picks up some patterns from the training data that are not real pattern in the training data but random quirks. That way, the model is overfitting and it is not generalized enough to predict new data, hence the low accuracy in validation data. Since validation data is a proxy to test and real life data, the validation accuracy is more important.</p></li>
<li><p>I think the <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> is generalized enough to be used on other spotify users. <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> controls the tree depth, which is the maximum thresholds and features that we use to identify a user preference of each song. Even though the trained model will not work (i.e. We need the user’s personal data to train the model again), the hyper parameter can be similar. It should be enough to identify a personal preference by asking a similar amount of questions to different human by the similar features.</p></li>
</ol>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="EDA.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Exploratory data analysis</p>
        </div>
    </a>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Macy Chan<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>